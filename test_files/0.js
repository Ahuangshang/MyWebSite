webpackJsonp([0],[,,function(e,t,n){"use strict";var r,a;r=function(e,t){var n,r,a,i,o;return a=function(e){return"ACCEPTED"===e?t("i18n")("merged","code_merge"):"REFUSED"===e?t("i18n")("refused","code_merge"):"CANMERGE"===e?t("i18n")("can_merge","code_merge"):"CANNOTMERGE"===e?t("i18n")("cannot_auto_merge","code_merge"):"CANCEL"===e?t("i18n")("canceled","code_merge"):void 0},r=function(e){return"pull-right pr-status "+e.toLowerCase()},n=function(t,n){return e.listBranches({username:t,project_name:n})},i=function(t,n,r,a,i,o){return e.merge_request_create({username:t,project_name:n,src_branch:r,des_branch:a,diff:i,w:o})},o=function(t,n,r){return e.merge_request_submit({username:t,project_name:n},r)},{getMergeStatusHuman:a,getMergeStatusClass:r,branches:n,mergeRequestCreate:i,mergeRequestSubmit:o}},a=n(1),r.$inject=["Depot","$filter"],e.exports=a.module("git.merge.service",[]).service("MergeRequestService",r)},,function(e,t){var n,r,a,i=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},s={}.hasOwnProperty;r=function(){function e(){}return e.prototype.MARGIN={top:20,right:20,bottom:30,left:50},e.prototype.x_domain=null,e.prototype.y_domain=null,e.prototype.dates=[],e.set_x_domain=function(t){return e.prototype.x_domain=t},e.set_y_domain=function(t){return e.prototype.y_domain=[0,d3.max(t,function(e){var t,n;return e.commits=null!=(t=null!=(n=e.commits)?n:e.additions)?t:e.deletions})]},e.init_x_domain=function(t){return e.prototype.x_domain=d3.extent(t,function(e){return e.date})},e.init_y_domain=function(t){return e.prototype.y_domain=[0,d3.max(t,function(e){var t,n;return e.commits=null!=(t=null!=(n=e.commits)?n:e.additions)?t:e.deletions})]},e.init_domain=function(t){return e.init_x_domain(t),e.init_y_domain(t)},e.set_dates=function(t){return e.prototype.dates=t},e.prototype.set_x_domain=function(){return this.x.domain(this.x_domain)},e.prototype.set_y_domain=function(){return this.y.domain(this.y_domain)},e.prototype.set_domain=function(){return this.set_x_domain(),this.set_y_domain()},e.prototype.create_scale=function(e,t){return this.x=d3.time.scale().range([0,e]).clamp(!0),this.y=d3.scale.linear().range([t,0]).nice()},e.prototype.draw_x_axis=function(){return this.svg.append("g").attr("class","x axis").attr("transform","translate(0, "+this.height+")").call(this.x_axis)},e.prototype.draw_y_axis=function(){return this.svg.append("g").attr("class","y axis").call(this.y_axis)},e.prototype.set_data=function(e){return this.data=e},e}(),a=function(e){function t(e){this.data=e,this.update_content=i(this.update_content,this),this.width=$(".graph.container").width()-70,this.height=200,this.x=null,this.y=null,this.x_axis=null,this.y_axis=null,this.area=null,this.svg=null,this.brush=null,this.x_max_domain=null}return o(t,e),t.prototype.process_dates=function(e){var t;return t=this.get_dates(e),this.parse_dates(e),r.set_dates(t)},t.prototype.get_dates=function(e){return _.map(e,"date")},t.prototype.parse_dates=function(e){var t;return t=d3.time.format("%Y-%m-%d").parse,e.forEach(function(e){return e.date=t(e.date)})},t.prototype.create_scale=function(){return t.__super__.create_scale.call(this,this.width,this.height)},t.prototype.create_axes=function(){return this.x_axis=d3.svg.axis().scale(this.x).orient("bottom"),this.y_axis=d3.svg.axis().scale(this.y).orient("left").ticks(5)},t.prototype.create_svg=function(){return this.svg=d3.select("#contributors-master").append("svg").attr("width",this.width+this.MARGIN.left+this.MARGIN.right).attr("height",this.height+this.MARGIN.top+this.MARGIN.bottom).attr("class","tint-box").append("g").attr("transform","translate("+this.MARGIN.left+","+this.MARGIN.top+")")},t.prototype.create_area=function(e,t){return this.area=d3.svg.area().x(function(t){return e(t.date)}).y0(this.height).y1(function(e){var n,r,a;return a=e.commits=null!=(n=null!=(r=e.commits)?r:e.additions)?n:e.deletions,t(a)}).interpolate("basis")},t.prototype.create_brush=function(){return this.brush=d3.svg.brush().x(this.x).on("brushend",this.update_content)},t.prototype.draw_path=function(e){return this.svg.append("path").datum(e).attr("class","area").attr("d",this.area)},t.prototype.add_brush=function(){return this.svg.append("g").attr("class","selection").call(this.brush).selectAll("rect").attr("height",this.height)},t.prototype.update_content=function(){return r.set_x_domain(this.brush.empty()?this.x_max_domain:this.brush.extent()),$("#brush_change").trigger("change")},t.prototype.draw=function(){return this.process_dates(this.data),this.create_scale(),this.create_axes(),r.init_domain(this.data),this.x_max_domain=this.x_domain,this.set_domain(),this.create_area(this.x,this.y),this.create_svg(),this.create_brush(),this.draw_path(this.data),this.draw_x_axis(),this.draw_y_axis(),this.add_brush()},t.prototype.redraw=function(){return this.process_dates(this.data),r.set_y_domain(this.data),this.set_y_domain(),this.svg.select("path").datum(this.data),this.svg.select("path").attr("d",this.area),this.svg.select(".y.axis").call(this.y_axis)},t}(r),n=function(e){function t(e){this.data=e,this.width=$(".graph.container").width()/2-100,this.height=200,this.x=null,this.y=null,this.x_axis=null,this.y_axis=null,this.area=null,this.svg=null,this.list_item=null}return o(t,e),t.prototype.create_scale=function(){return t.__super__.create_scale.call(this,this.width,this.height)},t.prototype.create_axes=function(){return this.x_axis=d3.svg.axis().scale(this.x).orient("bottom").ticks(8),this.y_axis=d3.svg.axis().scale(this.y).orient("left").ticks(5)},t.prototype.create_area=function(e,t){return this.area=d3.svg.area().x(function(t){var n;return n=d3.time.format("%Y-%m-%d").parse,e(n(t))}).y0(this.height).y1(function(e){return function(n){return t(null!=e.data[n]?e.data[n]:0)}}(this)).interpolate("basis")},t.prototype.create_svg=function(){return this.list_item=d3.selectAll(".person")[0].pop(),this.svg=d3.select(this.list_item).append("svg").attr("width",this.width+this.MARGIN.left+this.MARGIN.right).attr("height",this.height+this.MARGIN.top+this.MARGIN.bottom).attr("class","spark").append("g").attr("transform","translate("+this.MARGIN.left+","+this.MARGIN.top+")")},t.prototype.draw_path=function(e){return this.svg.append("path").datum(e).attr("class","area-contributor").attr("d",this.area)},t.prototype.draw=function(){return this.create_scale(),this.create_axes(),this.set_domain(),this.create_area(this.x,this.y),this.create_svg(),this.draw_path(this.dates),this.draw_x_axis(),this.draw_y_axis()},t.prototype.redraw=function(){return this.set_domain(),this.svg.select("path").datum(this.dates),this.svg.select("path").attr("d",this.area),this.svg.select(".x.axis").call(this.x_axis),this.svg.select(".y.axis").call(this.y_axis)},t}(r),e.exports={ContributorsGraph:r,ContributorsMasterGraph:a,ContributorsAuthorGraph:n}},,,function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s){var c,u;return e.type="blame",e.inner_menu="basic",e.tag_menu="basic",e.loaded=!1,e.empty=!1,e.blame={},e.path=[],e.ref=e.DEPOT.default_branch||"master",u=a.path(),c=u.substring(u.search("/git/blame/")+11,u.length),e.DEPOT===!1?void(e.empty=!0):(r.blame({username:n.username,project_name:n.project_name,region:encodeURIComponent(c)},function(t){return e.blame=t.data,e.path=encodeURIComponent(t.data.file.path).replace(/%2F/g,"/"),e.ref=encodeURIComponent(t.data.ref).replace(/%2F/g,"/"),e.blob_url=e.PROJECT.project_path+"/git/blob/"+e.ref+"/"+e.path,e.raw_url=e.PROJECT.project_path+"/git/raw/"+e.ref+"/"+e.path,e.commits_url=e.PROJECT.project_path+"/git/commits/"+e.ref+"/"+e.path,e.blame_url=e.PROJECT.project_path+"/git/blame/"+e.ref+"/"+e.path,o.set(s("i18n")("blame","code_blame")+t.data.file.path,e.PROJECT.owner.global_key,e.PROJECT.name,"Coding.net"),e.loaded=!0}),e.isSame=function(e,t,n){var r;return r=n-1,r>=0&&t.commitId===e.commitId})},a=n(1),r.$inject=["$scope","$rootScope","$routeParams","Depot","$location","Errors","PageTitle","$filter"],e.exports=a.module("git.blame",[]).controller("BlameController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c){var u,d;return e.inner_menu="basic",e.tag_menu="basic",e.type="blob",e.isHead=!1,e.can_edit=!1,e.loaded=!1,e.empty=!1,e.blob=[],e.ref=[],e.path=[],e.CodingUrl=n.path(),e.fileTypeIcon={executable:"terminal outline icon",file:"text file outline icon",sym_link:"url icon"},e.fileIcon=function(t){return s.smartSwitch(e.fileTypeIcon,t,t)},e.DEPOT===!1?void(e.empty=!0):(d=n.path(),u=d.substring(d.search("/git/blob/")+10,d.length),r.blob({username:t.username,project_name:t.project_name,region:encodeURIComponent(u)},function(r){return r.data.file?(e.blob=r.data,e.ref=encodeURIComponent(r.data.ref).replace(/%2F/g,"/"),e.path=encodeURIComponent(r.data.file.path).replace(/%2F/g,"/"),e.raw_url=e.PROJECT.project_path+"/git/raw/"+encodeURIComponent(e.ref+"/"+e.path).replace(/%2F/g,"/"),e.isHead=r.data.isHead,e.can_edit=r.data.can_edit,e.loaded=!0,i.set(r.data.file.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net")):(o.fail().send(c("i18n")("path_not_found","code_blob")),n.path("/u/"+t.username+"/p/"+t.project_name+"/git/tree/"+encodeURIComponent(r.data.ref)).replace(/%2F/g,"/"))}),e.copyCommit=function(){e.showCopyIcon=!0,setTimeout(function(){e.showCopyIcon=!1,e.$digest()},1e3)})},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","Errors","PageTitle","Flash","Common","$filter"],e.exports=a.module("git.blob",[]).controller("BlobController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n){var r;if(e.DEPOT.hasCommits)return e.default_branch=e.DEPOT.default_branch,e.form={default_branch:e.default_branch},e.submiting=!1,r=t.listBranches({username:n.username,project_name:e.PROJECT.name}),r.then(function(t){return e.branches=t.data}),e.submit=function(){var r;if(e.form.default_branch!==e.DEPOT.default_branch)return e.submiting=!0,r=t.setDefaultBranch({username:n.username,project_name:e.PROJECT.name},e.form),r.then(function(){var t,n;return n=_.findIndex(e.$parent.branches,function(t){return t.name===e.DEPOT.default_branch}),n>-1&&(e.$parent.branches[n].is_default_branch=!1),t=_.findIndex(e.$parent.branches,function(t){return t.name===e.form.default_branch}),t>-1&&(e.$parent.branches[t].is_default_branch=!0),e.DEPOT.default_branch=e.form.default_branch}),r["finally"](function(){e.submiting=!1})}},a=n(1),r.$inject=["$scope","Depot","$routeParams"],e.exports=a.module("git.branch.change-default",[]).controller("ChangeDefaultBranchModalCtrl",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,i,o,s,c,u,d,l){var m,f,p,h,g,_,v,w,b;return e.inner_menu="branch",e.tag_menu="branch",e.loaded=!1,e.branches=[],e.branchMembers=[],e.branchMetricsLoaded=!1,e.branchMetrics={},h="",e.dropdown_settings={className:{active:""}},p=1,f=e.changeDefaultBranchModal=u.instance("change-default-branch-modal"),b=e.pager_id=(new Date).getTime(),m=s.instance(b,e),v=function(a){return e.filterTitle=d("i18n")("key_word","code_merge")+":"+n.search().q,e.loaded=!1,r.branches_filter({page:a,username:t.username,project_name:t.project_name,q:n.search().q},function(t){if(0===t.code&&t.data){if(a>t.data.totalPage)return v(t.data.totalPage);e.branches=g(t.data.list),m.optionsReady(t.data)}o.set(d("i18n")("branch","code_branches"),e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0,p=a,_()})},m.onChange(function(e){v(e)}),g=function(e){var t,n,r,a,i;for(n=function(e){return Object.defineProperty(e,"allow_force_push",{get:function(){return!e.deny_force_push},set:function(t){return e.deny_force_push=!t}}),e},i=[],r=0,a=e.length;a>r;r++)t=e[r],i.push(n(t));return i},v(1),_=function(){return e.branchMetricsLoaded=!1,r.listBranches({username:t.username,project_name:t.project_name},function(n){var a,i,o,s,c,u,d,l,m,f,p;for(d=n.data,o=0,c=d.length;c>o;o++)if(a=d[o],a.is_default_branch){h=a.last_commit.commitId;break}for(f={},l=e.branches,i=function(e){return f[e.last_commit.commitId]=!0},s=0,u=l.length;u>s;s++)a=l[s],i(a);return p=function(){var e;e=[];for(m in f)e.push(m);return e}(),r.getBranchMetrics({username:t.username,project_name:t.project_name,base:h,targets:p.join()},function(t){return e.branchMetrics=t.data,e.branchMetricsLoaded=!0})})},w=function(n){return r.listProtectedBranchMember({username:t.username,project_name:t.project_name,branch_name:n},function(t){var n;0===t.code?(e.branchMembers=t.data,n=0,a.forEach(e.branchMembers,function(e){return e.has_update_access?n++:void 0}),e.memberCount=n):i.handle(t)})},e.delete_branch=function(n){return confirm(d("i18n")("confirm_to_delete_branch","code_branches",n.name))?r.delete_branch({username:t.username,project_name:t.project_name},{branch_name:n.name},function(t){var r;return c.success().send(d("i18n")("delete_successfully","code_branches")),r=$.map(e.branches,function(e){return e.name!==n.name?e:void 0}),r.length<=0?v(p):e.branches=r}):void 0},e.dropdownOptions={formatSelection:function(){return d("i18n")("add_branches_admin","code_branches")},width:"100%",formatResult:function(e){var t;return e.id?"0"===e.id?e.text:(t=[],t.push("<div>"),t.push("<img class='ui image' src='"+$(e.element).attr("data-user-avatar")+"'/>"),t.push("<span class='ellipsis'>"+e.text+"</span>"),t.push("</div>"),t.join("")):e.text},dropdownCssClass:"select-reviewer",matcher:function(e,t,n){var r,i,o;return t=t.trim(),r=$(n).data("pinyin"),o=0===t.toUpperCase().indexOf(e.toUpperCase()),a.isUndefined(r)?o:(i=r.split("|"),3!==i.length?o:i[1].indexOf(e)>=0||i[2].indexOf(e)>=0||o)}},e.protected_branch=function(t){$(".ui.checkbox").checkbox(),t.member_select=0,t.show_protected_branch_setting?t.show_protected_branch_setting=!1:(w(t.name),a.forEach(e.branches,function(e,n){return e.show_protected_branch_setting=e.name===t.name}))},e.toggleProtectedBranch=function(e){return e.is_protected?r.enableProtectedBranch({username:t.username,project_name:t.project_name},{branch_name:e.name},function(t){return c.success().send(d("i18n")("open_protected_branch_successfully","code_branches",e.name)),w(e.name)})["catch"](function(e,t){member.has_update_access=!1}):r.disableProtectedBranch({username:t.username,project_name:t.project_name},{branch_name:e.name},function(t){return c.success().send(d("i18n")("close_protected_branch_successfully","code_branches",e.name)),w(e.name)})["catch"](function(t,n){e.is_protected=!0})},e.togglePushBranch=function(e,n){return r.enableProtectedBranchMemberPush({username:t.username,project_name:t.project_name},{branch_name:e.name,target_global_key:n.user.global_key,enable:n.has_push_access},function(t){return c.success().send(d("i18n")("option_successfully","code_branches")),w(e.name)})},e.addMember=function(n){var a,i,o,s,u;for(s=e.branchMembers,u=[],a=0,i=s.length;i>a;a++){if(o=s[a],o.user.global_key===n.member_select){r.addProtectedBranchMember({username:t.username,project_name:t.project_name},{branch_name:n.name,target_global_key:o.user.global_key},function(e){return c.success().send(d("i18n")("option_successfully","code_branches")),w(n.name)});break}u.push(void 0)}return u},e.removeMember=function(e,n){return r.removeProtectedBranchMember({username:t.username,project_name:t.project_name},{branch_name:e.name,target_global_key:n.user.global_key},function(t){return c.success().send(d("i18n")("option_successfully","code_branches")),w(e.name)})},e.toggleDenyForcePush=function(e){return e.deny_force_push?r.enableDenyForcePushBranch({username:t.username,project_name:t.project_name},{branch_name:e.name},function(e){return c.success().send(d("i18n")("option_successfully","code_branches"))})["catch"](function(t,n){e.deny_force_push=!1}):r.disableDenyForcePushBranch({username:t.username,project_name:t.project_name},{branch_name:e.name},function(e){return c.success().send(d("i18n")("option_successfully","code_branches"))})["catch"](function(t,n){e.deny_force_push=!0})},e.toggleForceSquash=function(e){var n;return n=e.force_squash?"enableForceSquashBranch":"disableForceSquashBranch",r[n]({username:t.username,project_name:t.project_name},{branch_name:e.name},function(e){return c.success().send(d("i18n")("option_successfully","code_branches"))})["catch"](function(t,n){e.force_squash=!e.force_squash})},e.changeDefaultBranch=function(){return f.toggle()},e.canModifyDefaultBranch=function(t){return d("isRole")(e.PROJECT,e.ADMIN)&&t.is_default_branch},e.canSetProtectedBranch=function(t){return d("isRole")(e.PROJECT,e.ADMIN)||e.PROJECT&&"member"===e.PROJECT.current_user_role&&t.is_protected},e.canDeleteBranch=function(t){return(d("isRole")(e.PROJECT,e.ADMIN)||e.PROJECT&&"member"===e.PROJECT.current_user_role&&!t.is_protected)&&!t.is_default_branch},e.shouldShowMoreBranchOperator=function(t){return e.PROJECT&&!e.PROJECT.is_public||e.canModifyDefaultBranch(t)||e.canSetProtectedBranch(t)||e.canDeleteBranch(t)},e.showClearFilter=function(){var e;return e=n.search(),e.q},e.clearFilter=function(){return n.skipReload().search(""),e.keyword="",v(1)},e.updateSearch=function(){return n.skipReload().search("q",e.keyword),v(1)}},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","Errors","PageTitle","Pager","Flash","ModalService","$filter","$rootScope"],e.exports=a.module("git.branch.index",[]).controller("BranchIndexController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s){return e.inner_menu="branch",e.tag_menu="branch",e.loaded=!1,e.new_branch={},e.create_branch=function(a){return r.create_branch({username:t.username,project_name:t.project_name},{branch_name:a.name,start_point:a.start_point},function(t){return o.success().send(s("i18n")("option_successfully","code_branches")),n.path(e.PROJECT.project_path+"/git/branches")})}},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","PageTitle","Pager","Flash","$filter"],e.exports=a.module("git.branch.new",[]).controller("BranchNewController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,i,o,s){var c,u;return e.inner_menu="basic",e.tag_menu="basic",e.loaded=!1,e.diffHtml="",e.diffStat={},e.commit={},e.href=i.path(),e.diffMode=n.diff||o("diff_mode")||"",""!==e.diffMode&&o("diff_mode",e.diffMode,{path:"/",expires:365}),e.ignoreWhitespace="1"===n.w,e.enableWhitespace=!0,u=i.path(),c=u.substring(u.search("/git/commit/")+12,u.length),r.commit({username:n.username,project_name:n.project_name,region:encodeURIComponent(c),diff:e.diffMode,w:e.ignoreWhitespace?"1":""},function(n){var r,i;return n.data.commitDetail?(e.commit=n.data.commitDetail,e.diffStat=e.commit.diffStat,e.diffHtml=e.commit.diffHtml):(e.commit=n.data.commit,e.diffStat=n.data.diffStat,e.diffTooLong=n.data.message),e.shortMessage=e.commit.shortMessage,e.fullMessage=e.commit.fullMessage,e.allMessage=e.commit.allMessage,s.set("Commit",e.commit.commitId,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0,i=[],r=[],a.forEach(n.data.commitComments,function(e){return 0===e.position?r.push(e):i.push(e)}),e.commitId=e.commit.commitId,e.noteable_type="Commit",e.diffComments=r,e.showForm=!0,e.atConfig={target:t.PROJECT,type:"project_topic"},e.notesParams={commitId:e.commitId,comments:i,noteable_type:e.noteable_type,atConfig:e.atConfig}}),e.replacePath=function(e){return e.replace(/[.\/]/g,"_")}},a=n(1),r.$inject=["$scope","$rootScope","$routeParams","Depot","location","ipCookie","PageTitle"],e.exports=a.module("git.commit",[]).controller("CommitController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){var s,c,u;return e.type="commits",e.inner_menu="basic",e.tag_menu="basic",e.loaded=!1,e.commits={},e.current_page=t.page||1,e.cur_path=r.path(),e.page_size=20,u=r.path(),c=u.substring(u.search("/git/commits/")+13,u.length),(s=function(r,a){return n.commits({username:t.username,project_name:t.project_name,region:encodeURIComponent(c),pageSize:e.page_size,page:a},function(t){e.commits=t.data.commits.list,e.current_page=t.data.commits.page,e.page_size=t.data.commits.pageSize,e.path=encodeURIComponent(t.data.path).replace(/%2F/g,"/"),e.ref=encodeURIComponent(t.data.ref).replace(/%2F/g,"/"),e.path&&e.path.length>0?i.set(t.data.path+o("i18n")("history","code_commits"),e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"):i.set(o("i18n")("history","code_commits"),e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0})})(u,e.current_page)},a=n(1),r.$inject=["$scope","$routeParams","Depot","$location","Pager","PageTitle","$filter"],e.exports=a.module("git.commits",[]).controller("CommitsController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c,u){var d,l,m,f,p;return e.inner_menu="compare",e.tag_menu="compare",e.commits=null,e.ref1="",e.ref2="",e.diff=null,e.diffStat=null,e.diffMode=t.diff||a("diff_mode")||"",""!==e.diffMode&&a("diff_mode",e.diffMode,{path:"/",expires:365}),e.ignoreWhitespace="1"===t.w,e.enableWhitespace=!0,e.loaded=!1,e.refs=[],e.refsLoaded=!1,e.welcome=!1,p=r.path(),m=p.substring(p.search("/git/compare/")+13,p.length),l=m.split("..."),e.ref1=l[0],e.ref2=l[1],f=e.$watch("refsLoaded",function(r){return r!==!1?(p.indexOf("...")>0?n.compare({username:t.username,project_name:t.project_name,region:encodeURIComponent(m),diff:e.diffMode,w:e.ignoreWhitespace?"1":""},function(n){return e.commits=n.data.commits,e.commitId=n.data.ref2,e.baseCommitId=n.data.ref1,e.include_base=!1,e.diff=n.data.diff,e.diffStat=n.data.diff?n.data.diff.diffStat:n.data.diffStat,n.data.diff&&(e.diffHtml=n.data.diff.htmlDiff),e.nocommits=n.data.nocommits,e.loaded=!0,o.set(u("i18n")("compare_title","code_compare"),n.data.ref1+"..."+n.data.ref2,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.switchTab(parseInt(t.tab)||1)})["catch"](function(t,n){return e.commits=!1,e.nocommits=!1,e.loaded=!0}):(e.welcome=!0,e.refs&&e.refs.length>0&&(e.ref1=e.refs[0],e.ref2=e.refs[0])),f&&f()):void 0}),d=function(){var r,a,i;return i={username:t.username,project_name:t.project_name},r=n.listBranches(i),a=n.listTags(i),s.all([r,a]).then(function(t){var n,r,a,i,o,s,c,u;for(c=[],n=0,a=t.length;a>n;n++)for(u=t[n],s=u.data,r=0,i=s.length;i>r;r++)o=s[r],c.push(o.name);return e.refs=c,e.refsLoaded=!0})},d(),e.submitCompare=function(t,n){c.reload(),r.path(e.PROJECT.project_path+"/git/compare/"+t+"..."+n)},e.replacePath=function(e){return e.replace(/[.\/]/g,"_")},e.subMessage=function(e,t){var n;return n=t>=e.shortMessage.length,t=n?e.shortMessage.length:t,e.shortMessage.substring(0,t)+(n?"":"...")},e.populateCommits=function(t){var n,r,a,i;for(i in t)r=t[i],a=e.dateFormat(r.commitTime),e.commits=e.commits||{},n=e.commits[a]||[],n.push(r),e.commits[a]=n},e.dateFormat=function(e){var t;return t=new Date(e),Number.prototype.padLeft=function(e,t){var n;return n=String(e||10).length-String(this).length+1,n>0?new Array(n).join(t||"0")+this:this},[t.getFullYear(),(t.getMonth()+1).padLeft(),t.getDate().padLeft()].join(".")},e.switchTab=function(t){e.switchTabValue=t,1===t&&(t=void 0),r.skipReload().search("tab",t)}},a=n(1),r.$inject=["$scope","$routeParams","Depot","location","ipCookie","Errors","PageTitle","$q","$route","$filter"],e.exports=a.module("git.comapre",[]).controller("CompareController",r)},function(e,t,n){"use strict";var r,a;a=function(e,t){return{templateUrl:"git/directives/branch-metric/branch-metric.html",link:function(n,r,a){var i,o;return o=e(a.metricData),n.$watch(o,function(e){return e?(n.ahead=e.ahead,n.behind=e.behind,$(r).popup({content:i(e.ahead,e.behind),inline:!0})):void 0}),i=function(e,n){var r;return r=function(){switch(!1){case!(e>1&&n>1):return"popup_branch_metric_with_aheads_and_behinds";case!(e>1&&1===n):return"popup_branch_metric_with_aheads_and_one_behind";case!(e>1&&0===n):return"popup_branch_metric_only_with_aheads";case!(1===e&&n>1):return"popup_branch_metric_with_one_ahead_and_behinds";case!(1===e&&1===n):return"popup_branch_metric_with_one_ahead_and_one_behind";case!(1===e&&0===n):return"popup_branch_metric_only_with_one_ahead";case!(0===e&&n>1):return"popup_branch_metric_only_with_behinds";case!(0===e&&1===n):return"popup_branch_metric_only_with_one_behind";case!(0===e&&0===n):return"popup_branch_metric_without_aheads_and_behinds"}}(),t("i18n")(r,"code_branches",e,n)}}}},r=n(1),a.$inject=["$parse","$filter"],e.exports=r.module("git.branch.metric.directive",[]).directive("cgGitBranchMetric",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n,r,a,i){return{templateUrl:"git/directives/bread-crumb/bread-crumb.html",scope:{ref:"=",path:"="},link:function(o,s,c){var u,d,l,m,f,p,h,g,_,v;if(u=c.context||"tree",v=decodeURIComponent(o.ref),_=o.path,_&&(_=decodeURIComponent(_)),null!=_){for(o.type=o.$parent.type,o.can_edit=o.$parent.can_edit,o.PROJECT||(o.PROJECT=o.$parent.PROJECT),g=_.split("/"),"blob"===o.type&&(o.originFilename=g.pop()),o.filename=o.originFilename,o.parts=[],h=o.PROJECT.project_path+"/git/"+u+"/"+v,d=l=0,m=g.length;m>l;d=++l)p=g[d],f={text:e.htmlEncode(p),path:h+"/"+g.slice(0,d+1).join("/")},o.parts.push(f);return o.submitting=!1,o.submitRename=function(e){var s,c;return o.submitting=!0,c=r.path(),s=c.substring(c.indexOf("/git/blob/")+10,c.length),t.do_rename_tree({username:n.username,project_name:n.project_name,region:encodeURIComponent(s)},{newName:e},function(t){var n,s,c;if(0===t.code)return a.success().send(i("i18n")("option_successfully","code_branches")),r.path(r.$$path.substring(0,r.$$path.length-o.originFilename.length)+e);if(t.msg){o.submitting=!1,s=[];for(n in msg)c=msg[n],s.push(a.fail().send(c));return s}})["finally"](function(e,t){return o.submitting=!1})},o.cancelRename=function(){return o.filename=o.originFilename},o.renameTextInputPasteEventHandler=function(e){var t;return e.preventDefault(),t=e.originalEvent.clipboardData.getData("text/plain"),document.execCommand("insertHTML",!1,t)},o.renameTextInputFocused=!1,o.renameTextInputFocusEventHandler=function(){return o.renameTextInputFocused=!0},o.renameTextInputBlurEventHandler=function(){return o.renameTextInputFocused=!1}}}}},r=n(1),a.$inject=["GitService","Depot","$routeParams","$location","Flash","$filter"],e.exports=r.module("git.breadcrumb.directive",[]).directive("cgGitBreadCrumb",a)},function(e,t,n){"use strict";var r,a;a=function(){return{restrict:"A",replace:!0,templateUrl:"git/directives/comment/comment.html",link:function(e,t,n){}}},r=n(1),a.$inject=[],e.exports=r.module("git.comment.directive",[]).directive("cgGitComment",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n,r){return{scope:{commitz:"="},restrict:"A",templateUrl:"git/directives/commit-item/commit-item.html",link:function(r,a,i){return r.PROJECT=e.PROJECT,r.copyCommit=function(e){return e.showCopyIcon=!0,setTimeout(function(){e.showCopyIcon=!1,r.$digest()},1e3)},r.toggleDiff=function(e){return e.show_full_message=!e.show_full_message,e.showDiff?e.showDiff=!1:e.diffHtml?e.showDiff=!0:(e.loading=!0,n.commit({username:t.username,project_name:t.project_name,region:e.commitId,diff:e.diffMode,w:e.ignoreWhitespace?"1":""},function(t){return t.data.commitDetail?(e.diffStat=t.data.commitDetail.diffStat,e.diffHtml=t.data.commitDetail.diffHtml):(e.diffStat=t.data.diffStat,e.diffTooLong=t.data.message),e.showDiff=!0,e.loading=!1}))}}}},r=n(1),a.$inject=["$rootScope","$routeParams","Depot","$timeout"],e.exports=r.module("git.commit-item.directive",[]).directive("cgGitCommitItem",a)},function(e,t,n){"use strict";var r,a;a=function(e){return{scope:{commits:"="},restrict:"A",replace:!0,templateUrl:"git/directives/commit-list/commit-list.html",link:function(t,n,r){return t.commitsWithDate=e.commitsGroupByDate(t.commits)}}},r=n(1),a.$inject=["GitService"],e.exports=r.module("git.commit-list.directive",[]).directive("cgGitCommitList",a)},function(e,t,n){"use strict";var r,a;a=function(e){return{template:'<div class="commitish-suggester"></div>',link:function(t,n,r){var a,i,o,s,c,u,d,l,m,f,p,h;return i=e(r.ngModel),l=e(r.refs),m=n.find("div.commitish-suggester"),d=[],h=null!=(s=r.width)?s:"250px",p=null!=(c=r.selectionPrefix)?c:"",o=null!=(u=r.preventCustomOption)?u:!1,f=function(e){var t,n,r,a;for(a=[],t=0,n=e.length;n>t;t++)r=e[t],a.push({id:r,text:r});return a},a=function(e,t){return e.concat({id:t,text:t})},t.$watch(l,function(e){return e&&null!=e.length&&e.length>0?d=f(e):void 0}),m.select2({width:h,initSelection:function(e,t){return t(f(d))},formatSelection:function(e){return e.id?p+"<strong>"+e.text+"</strong>":e.text},query:function(e){var t,n,r,a,i;for(t={results:[]},a=!1,n=0,r=d.length;r>n;n++)i=d[n],e.matcher(e.term,i.text)&&t.results.push(i),e.term===i.text&&(a=!0);return o||a||!e.term||t.results.push({id:e.term,text:e.term}),e.callback(t)}}),m.on("change",function(e){return t.$$phase||t.$apply(function(t){return i.assign(t,e.added.id)}),t.$eval(r.ngChange)}),t.$watch(i,function(e){return m.select2("data",{id:e,text:e})})}}},r=n(1),a.$inject=["$parse"],e.exports=r.module("git.commitish.suggester.directive",[]).directive("cgGitCommitishSuggester",a)},function(e,t,n){"use strict";var r,a;a=function(e){return{link:function(t,n,r){var a,i;return a=e.getCookie,i=e.setCookie,t.colorOn=a("colorOn")||!0,t.diffShowTab=a("diffShowTab")||!0,t.diffWrap=a("diffWrap")||!1,t.inlineDiffOn=a("inlineDiffOn")||!0,t.setOption=function(e,t){return i(e,t,new Date((new Date).getTime()+36e5))}}}},r=n(1),a.$inject=["$rootScope"],e.exports=r.module("git.diff.options.directive",[]).directive("cgGitDiffOptions",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n){return{scope:{diffStat:"=",diffMode:"=",diffHtml:"=",notesParams:"=",enableWhitespace:"=",commitId:"=",baseCommitId:"=",editFileBranch:"=",lintNotesLoaded:"=",lintNotes:"="},templateUrl:"git/directives/diff-show/diff-show.html",link:function(e,t,r){return e.location=n}}},r=n(1),a.$inject=["$routeParams","Depot","location"],e.exports=r.module("git.diff.show.directive",[]).directive("cgGitDiffShow",a)},function(e,t,n){"use strict";var r,a;a=function(){return{restrict:"A",replace:!0,templateUrl:"git/directives/diff/diff-notes.html",link:function(e,t,n){return e.element?void 0:e.element=t},controller:["$rootScope","$scope","$routeParams","$interval","$timeout","Depot","Common","LightMdEditorService",function(e,t,n,a,i,o,s,c){var u,d;return t.commentContent="",t.showLineNote=!1,r.isNumber(t.position)||(t.position=parseInt(t.position)||0),r.isNumber(t.line)||(t.line=parseInt(t.line)||0),r.isNumber(t.change_type)||(t.change_type=parseInt(t.change_type)||0),d=function(e){var n,r;if(t.element)return r=t.element.parent().parent().parent().prev(".header").find(".comment-count"),n=parseInt(r.html())||0,n+=e,r.html(n),n>0?(r.show(),r.prev("i.chat").show()):(r.hide(),r.prev("i.chat").hide())},d(t.diffComments.length),u=function(){return t.$destroy(),i(function(){var e;return t.element.parent().find(".diff-line-num.empty,.diff-line-code.empty").show(),e=t.element.parents(".diff"),t.element.remove(),0===e.find(".inline-comments").length?e.prev().find(".diff-header .toggle-notes").hide():void 0})},t.isShow=function(e){return t.inline||0===e.position?!0:t.showLineNote},t.showCommentForm=function(){return t.showForm=!0,i(function(){return t.element.find("textarea").focus()})},t.cancelComment=function(){return t.diffComments.length>0?t.showForm=!1:u()},t.replyComment=function(e){return t.inline&&i(function(){return t.element.find(".add-comment").triggerHandler("click")}),e&&e.author?c.atPerson(e.author.name,"diff-comment-editor"+(t.position||"")):void 0},t.commentDiff=function(r){return""!==r?o.add_line_note({username:n.username,project_name:n.project_name},{commitId:t.commitId,noteable_type:t.noteable_type,noteable_id:t.noteable_id,content:r,path:t.path,position:t.position||0,line:t.line||0,change_type:t.change_type||0,anchor:t.anchor},function(n){return e.$broadcast("line-notes.add",n.data,t.diffComments.length),t.inline&&t.cancelComment(),d(1)}):void 0},t.deleteComment=function(r){return confirm("确定删除此评论？")?o.del_line_note({username:n.username,project_name:n.project_name,id:r.id},function(n){return e.$broadcast("line-notes.del",r,t.diffComments.length),
d(-1)}):void 0},e.$on("line-notes.add",function(e,n){return n&&n.position===t.position?t.diffComments.push(n):void 0}),e.$on("line-notes.del",function(e,n){return n&&n.position===t.position&&(t.diffComments=s.removeOfId(t.diffComments,n.id),t.inline&&0===t.diffComments.length)?u():void 0})}]}},r=n(1),a.$inject=[],e.exports=r.module("git.diff-notes.directive",[]).directive("cgGitDiffNotes",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n,a,i,o,s,c){return{restrict:"A",link:function(u,d,l){var m,f,p,h,g,v,w,b,C,y;return h={},u.notesParams&&u.notesParams.comments&&r.forEach(u.notesParams.comments,function(e,t){return h[e.path]||(h[e.path]=[]),h[e.path].push(e)}),u.inlineComments=h,r.forEach(u.diffStat.paths,function(e){var t;return t=u.inlineComments[e.path],e.comentCount=(null!=t?t.length:void 0)||0}),u.changeDiffModeLoading=!1,u.changeDiffMode=function(e,n){var i,s,c,d,l,p,h;return c=u.diffStat.newSha,d=u.diffStat.oldSha,(c||d)&&(i=null!=(l=n.target)&&null!=(p=l.parentElement)&&null!=(h=p.parentElement)?h.nextElementSibling:void 0)?(s=i.innerHTML,i.innerHTML='<div class="diff" style="margin-left: 0; margin-top: 2px; padding: 6px; text-align: center;" ng-repeat-end> <i class="loading icon"></i> </div>',u.changeDiffModeLoading=!0,a.compare({username:t.username,project_name:t.project_name,region:d+"..."+c,diff:e},function(t){return i.innerHTML=t.data.diff.htmlDiff,u.diffMode=e,r.forEach($(i).find(".diff"),function(e,t){return v(r.element(e),t)}),C(t.data.diff.diffStat.paths),t.data.diff.diffStat.paths.length>5?(f.show(),m.hide()):(f.hide(),m.show()),o.skipReload().search("diff",e)})["catch"](function(e,t){return i.innerHTML=s})["finally"](function(){return u.changeDiffModeLoading=!1})):void 0},w=function(){var e,t,n;return t=u.diffHtml,(!t||""===t)&&u.diffStat.paths.length>0&&(n=r.element('<div class="header partial" ng-repeat-start="ds in diffStat.paths track by $index" data-path="{{ds.path}}" data-index="{{$index}}"> <div class="diff-header"> <span class="toggle-show-diff" ng-class="{count: ds.comentCount > 0}"> <i class="triangle icon right"></i> <span class="create change-type-icon" ng-if="ds.changeType == \'ADD\'"></span> <span class="update change-type-icon" ng-if="ds.changeType == \'MODIFY\'"></span> <span class="update change-type-icon" ng-if="ds.changeType == \'RENAME\'"></span> <span class="delete change-type-icon" ng-if="ds.changeType == \'DELETE\'"></span> <span class="diff-file-path" title="{{ds.path}}">{{ds.path}}</span> <i class="chat icon"></i> <span class="comment-count">{{ds.comentCount}}</span> </span> <span class="toggle-notes" style="display: none;"></span> <a ng-href="{{PROJECT.project_path}}/git/blob/{{ds.commitId}}/{{ds.path}}" class="small ui button view-file" target="_blank">查看文件</a> </div> </div> <div class="diff" style="display: none; margin-top: 2px; padding: 6px; text-align: center;" ng-repeat-end> <i class="loading icon"></i> </div>'),t=i(n)(u)),(!t||""===t)&&u.diffComments&&u.diffComments.length>0&&(e=u.diffComments[0],t='<div class="header">\n  <div class="diff-header">\n    <span class="toggle-show-diff">\n      <span class="update change-type-icon"></span>\n      <span class="diff-file-path">'+e.path+"（评论于第 "+e.line+" 行）</span>\n    </span>\n  </div>\n</div>"),d.html(t)},C=function(e){return $.each(e,function(){var e,t,n;return e=d.find("[data-path='"+this.name+"'] .diff-header a"),n=e.parent().find(".toggle-notes"),n.next().is("span.diffstat")?void 0:(t=r.element("<span cg-diffstat diffstat='{insertions: "+this.insertions+", deletions: "+this.deletions+"}' ></span>"),n.after(t),i(t)(u))})},g=function(e){var t,n,r,a,i,o;if(n=e.attr("lang"),"plain"!==n){for(i=e.find(".diff-line-code:not(.hunk-header) pre"),o=[],t=0,r=i.length;r>t;t++)a=i[t],o.push(u.highlight(a,n));return o}},b=function(t){var n,a;return r.forEach(t.find(".add-line-note"),function(n){var a,i,c,d,l,m;return n=r.element(n),l="split"===o.search().diff||"split"===s("diff_mode")||"split"===u.diffMode?n.parent().prev("th"):n.parent().parent().find("th"),d=n.attr("path"),u.inlineComments&&(i=u.inlineComments[d],i&&i.length>0&&(c=parseInt(n.attr("line")),m=parseInt(n.attr("type")),a=_.filter(i,function(e){return e.line!==c?!1:e.change_type>0?e.change_type===m:e.position===parseInt(n.attr("position"))}),a.length>0&&u.initComments(n,a))),e.USER?n.on("click",function(){var e;return e=t.prev().find(".diff-header .toggle-notes"),e.show(),e.find("input[type=checkbox]")[0].checked=!0,t.find(".inline-comments").show(),u.addLineComment(n)}):n.remove()}),a=t.prev().find(".diff-header .toggle-notes"),a.find("input[type=checkbox]").on("change",function(){return t.find(".inline-comments").toggle(this.checked)}),n=t.find(".inline-comments"),n.length>0&&a.show(),a.parent().parent().hasClass("show")?void 0:a.hide()},u.toggleFullScreenByHeader=function(e){var n,r;return r=e,n=r.next(".diff"),("MODIFY"===e.attr("change-type")||"RENAME"===e.attr("change-type"))&&a.compare({username:t.username,project_name:t.project_name,region:u.diffStat.oldSha+"..."+u.diffStat.newSha,diff:u.diffMode,path:r.attr("data-path"),w:u.ignoreWhitespace?"1":"",full:!0},function(e){return e.data.diff?(n.html(e.data.diff.htmlDiff),g(n),b(n)):void 0}),r.toggleClass("fullscreen-diff-header"),n.toggleClass("fullscreen-diff"),n.hasClass("fullscreen-diff")?($("body").css("overflow-y","hidden"),n.find(".inline-comments").show()):($("body").css("overflow-y",""),r.find("input[type=checkbox]")[0].checked?n.find(".inline-comments").show():n.find(".inline-comments").hide()),n.hasClass("fullscreen-diff")?$(window).bind("keyup",function(e){return 27===e.keyCode?$(".commit-diff .fullscreen-diff-header").each(function(){return u.toggleFullScreenByHeader($(this))}):void 0}):$(window).unbind("keyup")},v=function(e,n){var r,a,i,o,s;if(g(e),i=e.prev(".header"),i.parents(".diff-notes-wrapper").length>0||(u.diffStat.paths.length>5?(e.hide(),i.find("span.change-type-icon").before($('<i class="triangle icon right"></i>'))):(i.find("span.change-type-icon").before($('<i class="triangle icon down"></i>')),i.addClass("show"))),a=$('<a class="small ui button fullscreen">全屏对比</a>'),i.find(".view-file").before(a),u.editFileBranch&&""!==u.editFileBranch){if("DELETE"===i.attr("change-type"))return;s=i.data("path"),o="/u/"+t.username+"/p/"+t.project_name+"/git/edit/"+u.editFileBranch+"/"+s,r=$('<a href="'+o+'" class="small ui button edit-file">编辑文件</a>'),i.find(".view-file").before(r)}return i.find(".diff-header").before('<div class="fullscreen-diff-header-bar"><span><i class="left arrow icon"></i>'+(n+1)+" / "+u.diffStat.paths.length+'<i class="right arrow icon"></i></span><i class="remove icon"></i></div>'),0===n&&i.find("i.left.arrow.icon").addClass("disabled"),n===u.diffStat.paths.length-1&&i.find("i.right.arrow.icon").addClass("disabled"),i.find("i.remove.icon").on("click",function(){return y(this)}),i.find("i.right.arrow.icon").on("click",function(){return $(this).hasClass("disabled")?void 0:(u.toggleFullScreenByHeader($(this).parent().parent().parent()),u.toggleFullScreenByHeader($(this).parent().parent().parent().next(".diff").next(".header")))}),i.find("i.left.arrow.icon").on("click",function(){return $(this).hasClass("disabled")?void 0:(u.toggleFullScreenByHeader($(this).parent().parent().parent()),u.toggleFullScreenByHeader($(this).parent().parent().parent().prev(".diff").prev(".header")))}),i.find("a.fullscreen").on("click",function(){return y(this)}),u.notesParams?b(e):e.find(".add-line-note").remove()},f=$("a.diff-toggle-show-button.show-all"),m=$("a.diff-toggle-show-button.hide-all"),u.toggleShowAllDiff=function(){var e;return u.diffHtml&&""!==u.diffHtml?(e=d.find(".header"),e.each(function(e,t){var n,r;return n=$(t),r=n.find("i.triangle"),r.hasClass("right")&&(n.addClass("show"),n.next(".diff").slideDown(),r.removeClass("right"),r.addClass("down"),n.next(".diff").find(".inline-comments").length>0)?n.find(".toggle-notes").toggle():void 0}),f.hide(),void m.show()):c.fail().send("文件改动过多，请点击具体文件查看！")},u.toggleHideAllDiff=function(){var e;e=d.find(".header"),e.each(function(e,t){var n,r;return n=$(t),r=n.find("i.triangle"),r.hasClass("down")&&(n.removeClass("show"),n.next(".diff").slideUp(),r.removeClass("down"),r.addClass("right"),n.next(".diff").find(".inline-comments").length>0)?n.find(".toggle-notes").toggle():void 0}),f.show(),m.hide()},y=function(e){var t;return t=$(e).parent().parent(".header"),u.toggleFullScreenByHeader(t)},n(function(){return C(u.diffStat.paths),u.scrollToAnchor()}),w(),r.forEach(d.find(".diff"),function(e,t){return v(r.element(e),t)}),u.diffStat.paths.length>5?(f.show(),m.hide()):(f.hide(),m.show()),d.on("click",".toggle-show-diff",function(){var e,n,i,o;return e=$(this).parent().parent(),e.hasClass("fullscreen-diff-header")||e.parents(".diff-notes-wrapper").length>0?void 0:e.hasClass("partial")?(i=e.data("path"),e.next(".diff").show(),a.commit_diff_partial({username:t.username,project_name:t.project_name,region:u.commitId||(null!=(o=u.notesParams)?o.commitId:void 0),base_commit:u.baseCommitId,path:i,diff:u.diffMode,w:u.ignoreWhitespace,include_base:u.include_base},function(t){var n,a,o,s;return t.data&&""!==t.data?(o=r.element("<div>"+t.data+"</div>"),s=e.data("index"),n=o.find(".diff"),a=o.find(".header"),n.attr("id","diff-"+s),v(n,s),e.next(".diff").replaceWith(n),e.replaceWith(a),C(_.filter(u.diffStat.paths,function(e){return e.path===i})),a.hasClass("show")?void 0:r.element(a).find(".toggle-show-diff").click()):(e.next(".diff").html('<pre class="no-preview">无数据，文件改动太大了？</pre>'),e.removeClass("partial"))})):(n=$(this).find("i.triangle"),n.hasClass("right")?(e.addClass("show"),e.next(".diff").slideDown(),d.find(".header.show").length===u.diffStat.paths?(u.showShowAllDiffButton=!1,u.showHideAllDiffButton=!0,f.hide(),m.show()):(u.showHideAllDiffButton=!0,u.showShowAllDiffButton=!0,f.show(),m.show())):(e.next(".diff").slideUp(function(e){return function(){return 0===d.find(".header.show").length?(u.showShowAllDiffButton=!0,u.showHideAllDiffButton=!1,f.show(),m.hide()):(u.showShowAllDiffButton=!0,u.showHideAllDiffButton=!0,f.show(),m.show())}}(this)),e.removeClass("show")),n.toggleClass("down",n.hasClass("right")),n.toggleClass("right"),$(this).parent().parent().next(".diff").find(".inline-comments").length>0?$(this).next(".toggle-notes").toggle():void 0)}),d.on("click",".btn-expand",function(){var e,n;return e=r.element(this),a.blob_expand({username:t.username,project_name:t.project_name,region:u.commitId||(null!=(n=u.notesParams)?n.commitId:void 0),path:e.attr("path"),prev_line_no_left:e.attr("pleft"),prev_line_no_right:e.attr("pright"),next_line_no_left:e.attr("nleft"),next_line_no_right:e.attr("nright"),left_hunk_size:e.attr("lhunk"),right_hunk_size:e.attr("rhunk"),diff:e.attr("diff")},function(t){var n,a,i,o,s,c;for(i=e.parents(".diff").attr("lang"),n=r.element("<tbody>"+t.data+"</tbody>"),c=n.find(".diff-line-code:not(.hunk-header) pre"),a=0,o=c.length;o>a;a++)s=c[a],u.highlight(s,i);return e.parent().replaceWith(n.html())})}),p=function(){var e;return e={},r.forEach(u.lintNotes,function(t){var n,r;return r=t.location.path,e[r]||(e[r]={}),n=t.location.range.start_line,null==e[r][n]&&(e[r][n]=[]),e[r][n].push(t)}),r.forEach(d.find(".diff"),function(t){var n;return n=r.element(t),r.forEach(n.find(".code-line"),function(t){var n,a,i,o,s,c,u;return n=r.element(t),a=r.element(n.find(".diff-line-code")),i=r.element(n.find(".diff-line-num")[1]),u=r.element(a.find("pre")),c=a.find(".add-line-note").attr("path"),o=i.attr("line-data"),null!=c?null!=e[c]&&null!=e[c][o]?(u.addClass("lint-mark"),s="",r.forEach(e[c][o],function(e){return s+="<li>"+e.description+"</li>"}),u.popup({title:"代码存在如下缺陷：",content:"<ul>"+s+"</ul>",preserve:!0,context:".commit-diff"})):u.hasClass("lint-mark")?u.removeClass("lint-mark"):void 0:void 0})})},u.$watch("lintNotesLoaded",function(t){return e.isExpActive("lint")&&null!=t&&t===!0?p():void 0},!0)},controller:["$scope","$compile","hljsService",function(t,a,i){return t.highlight=function(e,t){var n;return n=e.textContent,n=n.replace(/\\ No newline at end of file$/,""),n=i.getLanguage(t)?i.highlight(t,n,!0).value:i.highlightAuto(n).value,e.innerHTML=n.replace(/\u0001\u0003/g,"<span class='x'>").replace(/\u0003\u0001/g,"</span>").replace(/\t/g,"<span class='t'>	</span>").replace(/\u0001\u0001$/,"<span class='no-newline'><i class='coding icon no-newline'></i></span>"),r.element(e).find("span.no-newline").popup({on:"hover",variation:"inverted",content:"文件末尾无换行符"})},t.scrollToAnchor=function(){var e,t,a,i;return t=window.location.hash,""!==t&&t.match(/^#(commit|mr|pr)-comment-\d+$/)?(e=window.location.hash.substring(1),i=r.element("[name="+e+"]"),i.length>0?(a=i.parents(".diff").prev(".header"),a.hasClass("show")||a.find("span.toggle-show-diff").trigger("click"),i.parents(".diff-notes-wrapper").removeClass("outdated"),window.scrollTo(0,i.offset().top-80),n(function(){i.parent().css("background-color","#F2C61F").animate({backgroundColor:"transparent"},1500,function(){return a.length>0?$(this).css("background-color","#fff"):void 0})})):void 0):void 0},t.initComments=function(i,o){var s,c,u,d,l,m,f;return null==o&&(o=[]),f=i.parent(),c=f.parent(),m=c.next(),s=function(r){var s;return s=e.$new(),s.diffComments=o,s.commitId=t.notesParams.commitId,s.noteable_type=t.notesParams.noteable_type,s.noteable_id=t.notesParams.noteable_id,s.atConfig=t.notesParams.atConfig,s.path=i.attr("path"),s.position=i.attr("position"),s.line=i.attr("line"),s.change_type=i.attr("type"),s.anchor=i.attr("anchor"),s.inline=!0,s.showForm=0===o.length,s.element=r,a(r.contents())(s),n(function(){return r.find("textarea").focus()})},d=function(){var e,t;return e=m.find(".line-comments"),e.length>0?e.find(".add-comment").triggerHandler("click"):(t=r.element("<tr class='inline-comments'> <td class='line-comments' colspan='4'> <div cg-git-diff-notes></div> </td> </tr>"),c.after(t),s(t))},l=function(){var e,t;return m.hasClass("inline-comments")?(e=m.find(".line-comments.left"),e.length>0?e.find(".add-comment").triggerHandler("click"):(m.find(".diff-line-num.empty").hide(),m.find(".diff-line-code.empty").hide(),t=r.element("<td class='line-comments left' colspan='2'> <div cg-git-diff-notes></div> </td>"),m.prepend(t),s(t))):(t=r.element("<tr class='inline-comments'> <td class='line-comments left' colspan='2'> <div cg-git-diff-notes></div> </td> <th class='diff-line-num empty'></th> <td class='diff-line-code empty'></td> </tr>"),c.after(t),s(t))},u=function(){var e,t;return m.hasClass("inline-comments")?(e=m.find(".line-comments.right"),e.length>0?e.find(".add-comment").triggerHandler("click"):(m.find(".diff-line-num.empty").hide(),m.find(".diff-line-code.empty").hide(),t=r.element("<td class='line-comments right' colspan='2'> <div cg-git-diff-notes></div> </td>"),m.append(t),s(t))):(t=r.element("<tr class='inline-comments'> <th class='diff-line-num empty'></th> <td class='diff-line-code empty'></td> <td class='line-comments right' colspan='2'> <div cg-git-diff-notes></div> </td> </tr>"),c.after(t),s(t))},4!==c.children().length?d():f.hasClass("ge")?d():f.hasClass("gd")?l():f.hasClass("gi")?u():void 0},t.addLineComment=function(e){return t.initComments(e)}}]}},r=n(1),a.$inject=["$rootScope","$routeParams","$timeout","Depot","$compile","$location","ipCookie","Flash"],e.exports=r.module("git.diff.directive",[]).directive("cgGitDiff",a)},function(e,t,n){"use strict";var r,a;a=function(e,t){return{templateUrl:"git/directives/file-navigation/file-navigation.html",link:function(n,r,a){var i;return n.branches=[],n.tags=[],n.context=a.context||"tree",i=t.listBranches({username:e.username,project_name:n.PROJECT.name}),i.then(function(r){return n.empty=!1,n.branches=r.data,t.listTags({username:e.username,project_name:n.PROJECT.name},function(e){return n.empty=!1,n.tags=e.data,n.tab=n.branches&&n.inRefs(n.branches.list,n.ref)?1:2,n.tab=n.tags&&n.inRefs(n.tags.list,n.ref)?2:1})["catch"](function(e,t){n.empty=!0})}),i["catch"](function(e,t){n.empty=!0}),n.inRefs=function(e,t){var n;for(n in e)if(t===e[n].name)return!0;return!1}}}},r=n(1),a.$inject=["$routeParams","Depot"],e.exports=r.module("git.file.navigation.directive",[]).directive("cgGitFileNavigation",a)},function(e,t,n){"use strict";var r,a;a=function(e,t){return{replace:!0,templateUrl:"git/directives/lfs-tips/lfs-tips.html",link:function(n,r,a){return n.USER=e.USER,n.hide=t["hide-lfs-tips"],n.toggleHide=function(){return t["hide-lfs-tips"]=!0,n.hide=!0}}}},r=n(1),a.$inject=["$rootScope","$localStorage"],e.exports=r.module("git.lfs-tips.directive",[]).directive("cgLfsTips",a)},function(e,t,n){"use strict";var r,a;a=function(){return{restrict:"A",replace:!0,templateUrl:"git/directives/readme/readme.html",link:function(e,t,n){e.readme=e.$eval(n.cgGitReadme)}}},r=n(1),a.$inject=[],e.exports=r.module("git.readme.directive",[]).directive("cgGitReadme",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n,r,a,i){return{templateUrl:"git/directives/release-attachment-upload/release-attachment-upload.html",scope:{attachmentList:"="},link:function(t,n,o){var s,c,u,d,l,m,f,p;return t.attachmentList=[],m=function(e){var n,r,a,i,o;for(o=t.attachmentList,r=a=0,i=o.length;i>a;r=++a)if(n=o[r],n.uuid===e.uuid)return void t.attachmentList.splice(r,1)},t.deleteAttachment=function(t){return t.uploading?void 0:(t.id&&t.id>0&&a.deleteReleaseAttachment({username:e.username,project_name:e.project_name},{attachmentId:t.id},function(e){var t,n,r,a;if(e&&0===e.code)return i.success().send("删除成功");r=e.msg,a=[];for(t in r)n=r[t],a.push(i.fail().send(n));return a}),m(t))},f=function(n){var a,o,s,c;return a={id:0,name:n.name,size:n.size,uploading:!0,percentage:0,failed:!1,uuid:r.uuid()},t.$apply(function(){return t.attachmentList.push(a)}),s="/api/user/"+e.username+"/project/"+e.project_name+"/git/releases/attachments/upload",o=new FormData,o.append("file",n),c=new XMLHttpRequest,c.upload.addEventListener("progress",function(e){return e.lengthComputable!==!1?t.$apply(function(){return a.percentage=Math.round(100*e.loaded/e.total)}):void 0},!1),c.addEventListener("load",function(e){var n,r,o,s,c;if(t.$apply(function(){return a.uploading=!1}),200===e.target.status){if(s=JSON.parse(e.target.response),0===s.code){if(s.data)return t.$apply(function(){return a.id=s.data.id}),t.$apply(function(){return a.name=s.data.name}),t.$apply(function(){return a.size=s.data.size})}else if(s.msg){t.$apply(function(){return a.failed=!0}),o=s.msg,c=[];for(n in o)r=o[n],c.push(i.fail().send(r));return c}}else switch(t.$apply(function(){return a.failed=!0}),e.target.status){case 500:return i.fail().send("服务器内部错误，有人要扣奖金了～");case 502:return i.fail().send("服务器正在更新，请稍后再试。");case 504:return i.fail().send("服务器正在更新，请稍后再试。");case 400:return i.fail().send("服务器/页面接口请求不匹配，前端要扣工资了～");case 404:return i.fail().send("请求的数据接口不存在",!1)}}),c.open("POST",s),c.send(o)},p=function(e){var t,n,r,a;for(a=[],n=0,r=e.length;r>n;n++)t=e[n],a.push(f(t));return a},s=function(e){var t;return t=$(e.originalEvent.target),t.hasClass("dragenter")?void 0:t.addClass("dragenter")},n.find(".upload-zone").bind("dragover",s),c=function(e){var t;return t=$(e.originalEvent.target),t.hasClass("dragenter")?t.removeClass("dragenter"):void 0},n.find(".upload-zone").bind("dragleave",c),n.find(".upload-zone").bind("drop",c),u=function(e){return p(e.originalEvent.dataTransfer.files)},n.find(".upload-zone").bind("drop",u),l=function(e){return $(e.target).find("input[type=file]").click()},n.find(".upload-zone").bind("click",l),d=function(e){return p(e.target.files)},n.find("input[type=file]").bind("change",d)}}},r=n(1),a.$inject=["$routeParams","$parse","$filter","Common","Depot","Flash"],e.exports=r.module("git.release.attachment.upload.directive",[]).directive("cgReleaseAttachmentUpload",a)},function(e,t,n){"use strict";var r,a;a=function(e,t,n){return{templateUrl:"git/directives/release-resource-reference/release-resource-reference.html",scope:{resourceReferences:"=",showAdd:"="},link:function(r,a,i){var o,s,c,u,d;return r.showAllResourceReferenceStyle=!1,r.showAllResourceReference=function(){return r.showAllResourceReferenceStyle=!0},c=function(){var e;for(e in r.resourceReferences)if(r.resourceReferences[e]&&r.resourceReferences[e].length>0)return!0;return!1},s=function(){var e,t;e=0;for(t in r.resourceReferences)r.resourceReferences[t]&&(e+=r.resourceReferences[t].length);return e},r.$watch("resourceReferences",function(){return r.showResourceReferences=c(),r.resourceReferenceCount=s()},!0),u=function(e){var t,n,a,i;if(i=r.resourceReferences[e.target_type],i&&i.length>0)for(t=0,n=i.length;n>t;t++)if(a=i[t],a.code===e.code)return!0;return!1},o=function(e){var t;if(!u(e))return t=e.target_type,r.resourceReferences[t]||(r.resourceReferences[t]=[]),r.resourceReferences[t].push(e)},r.deleteResource=function(e){var t,n;if(e&&r.showAdd)return t=function(t){return t&&t.length>0?$.grep(t,function(t){return t.code!==e.code}):t},n=e.target_type,r.resourceReferences[n]=t(r.resourceReferences[n])},r.imgPopup=function(e){return e.img?'<div style="word-break: break-all; line-height: 20px; position: relative; text-align: center;">\n    <div><img style="max-width: 100%;" src="'+e.img+'"/></div>\n</div>':void 0},d=function(){var a,i,s,c,u;return s=function(e){var n;return n={Task:function(){return"tasks icon"},ProjectTopic:function(){return"chat icon"},ProjectFile:function(){return"file icon"},MergeRequestBean:function(){return"coding merge-request icon"}},t.smartSwitch(n,e,e)},u=function(e){return e instanceof Array?(e=$.grep(e,function(e){return"Release"!==e.target_type}),$.each(e,function(e,t){return t.id=t.code})):void 0},c=function(t){return n.resourceByTypes({username:e.username,project_name:e.project_name,q:t.term,types:["Task","ProjectTopic","ProjectFile","PullRequestBean","MergeRequestBean"],pageSize:6},function(e){var n;return e&&0===e.code&&e.data?(n=u(e.data.list),t.callback({results:n})):void 0})},$("#reference_select").select2({placeholder:"请选择",width:"250px",minimumInputLength:0,query:c,formatResult:function(e){return'<div class="ellipsis">\n    <i class="'+s(e.target_type)+'"></i>\n    <span style="color: #666">#'+e.code+'</span>\n    <span style="padding-left: 10px; font-weight: bold;" class="ellipsis">'+e.title+"</span>\n</div>"},formatSelection:function(e){return'<div class="ellipsis">\n    <i class="'+s(e.target_type)+'"></i>\n    <span style="color: #666">#'+e.code+'</span>\n    <span style="padding-left: 10px; font-weight: bold;" class="ellipsis">'+e.title+"</span>\n</div>"},dropdownCssClass:"bigdrop select-release-refer",escapeMarkup:function(e){return e}}),$("#reference_select").on("change",function(){var t;return t=$(this).select2("val"),$(this).select2("val",""),n.resourceByCode({username:e.username,project_name:e.project_name,code:0|t},function(e){return e&&0===e.code&&e.data?o(e.data):void 0})}),i="click."+t.uuid(),a=$(".add-refer"),a.on(i,function(){return $("#reference_select").select2("open")}),r.$on("$destroy",function(){return $("#reference_select").select2("destroy"),a.off(i)})},r.showAdd?d():void 0}}},r=n(1),a.$inject=["$routeParams","Common","Search"],e.exports=r.module("git.release.resource.reference.directive",[]).directive("cgReleaseResourceReference",a)},function(e,t,n){"use strict";var r,a;a=function(e){return{link:function(t,n,r){var a;return a=e(r.cgScrollToFinderResultItem),t.$watch(a,function(e){var t,r,a,i,o;return o=document.body.scrollTop,i=o+document.body.clientHeight,a=$(n).offset().top,r=$(n).height(),t=a+r,e&&!(a>o+60&&i>t)&&(t>i&&window.scrollTo(0,o+t-i),o+60>a)?window.scrollTo(0,o-(o-a)-60):void 0})}}},r=n(1),a.$inject=["$parse"],e.exports=r.module("git.scroll.to.finder.result.item.directive",[]).directive("cgScrollToFinderResultItem",a)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c){var u,d;return e.inner_menu="basic",e.tag_menu="basic",e.type="blob",e.checkEdited=!0,e.message="",e.tree_url=n.$$path.replace("/delete/","/blob/"),d=n.path(),u=d.substring(d.search("/git/delete/")+12,d.length),e.DEPOT===!1?void(e.empty=!0):(e.fileTypeIcon={file:"text file outline icon",sym_link:"url icon"},e.fileIcon=function(t){return s.smartSwitch(e.fileTypeIcon,t,t)},r.delete_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(u)},function(t){return e.file=t.data.file,e.blob=e.file.data,e.path=encodeURIComponent(e.file.path).replace(/%2F/g,"/"),e.lastCommit=t.data.lastCommit,e.ref=encodeURIComponent(t.data.ref).replace(/%2F/g,"/"),a.set(c("i18n")("delete_file","code_delete")+e.file.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0})["catch"](function(t,n){e.loaded=!0}),e.checkMessage=function(){e.edited=0===e.message.length},e.submit=function(a){return e.checkEdited=!1,0!==a.length?r.do_delete_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(u)},{message:a,lastCommitSha:e.lastCommit},function(t){return n.path(e.DEPOT.depot_path),i.success().send(c("i18n")("delete_successfully","code_delete"))}):void 0})},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","PageTitle","Flash","Errors","Common","$filter"],e.exports=a.module("git.edit.delete",[]).controller("DeleteFileInGitController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s){var c,u,d,l;return e.inner_menu="basic",e.tag_menu="basic",e.type="edit",e.checkEdited=!0,e.previewed=!1,e.previewed_data="",u=ace.require("ace/ext/modelist"),l=a.path(),d=l.substring(l.search("/git/edit/")+10,l.length),e.DEPOT===!1?void(e.empty=!0):(c=function(){var t,n;return n=s("i18n")("confirm_leave","code_edit"),t=function(){return e.checkEdited&&e.edited?n:void 0},$(window).on("beforeunload",t),e.$on("$locationChangeStart",function(t){e.checkEdited&&e.edited&&!window.confirm(n)&&t.preventDefault()}),e.$on("$routeChangeStart",function(e){$(window).off("beforeunload",t)})},e.aceSettings={useWrapMode:!0,theme:"tomorrow",showGutter:!0,onLoad:function(e){e.getSession().setOption("useWorker",!1)},onChange:function(t){var n;n=t[1],e.data=n.getValue(),e.edited=!!e.file&&e.data!==e.file.data}},r.edit_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},function(t){e.file=t.data.file,e.blob=e.file.data,e.data=e.blob,e.path=encodeURIComponent(e.file.path).replace(/%2F/g,"/"),e.lastCommit=t.data.lastCommit,e.message="update "+t.data.filename,e.ref=t.data.ref,e.blob_url=e.PROJECT.project_path+"/git/blob/"+e.ref+"/"+e.path,i.set(s("i18n")("edit_file","code_edit")+e.file.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0,c(),e.aceSettings.mode=u.getModeForPath(e.path).mode.replace("ace/mode/","")}),e.preview_md=function(){return r.blobPreview({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},{data:e.data},function(t){var r;return 0===t.code?(r=t.data.replace(/{{CodingUrl}}/g,a.path()),e.previewed_data=n.trustAsHtml(r),e.previewed=!0):void 0})},e.close_preview=function(){return e.previewed=!1},e.is_markdown=function(e){return new RegExp(/.*(md|mdown|mkdown|markdown|mkdn)$/i).test(e)},e.applyEdit=function(n){return e.checkEdited=!1,r.update_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},{content:e.data,message:n,lastCommitSha:e.lastCommit},function(t){return a.path(decodeURIComponent(e.blob_url)),o.success().send(s("i18n")("option_successfully","code_edit"))})})},a=n(1),r.$inject=["$scope","$routeParams","$sce","Depot","$location","PageTitle","Flash","$filter"],e.exports=a.module("git.edit.edit",[]).controller("EditFileInGitController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){var s,c,u,d,l;return e.inner_menu="basic",e.tag_menu="basic",e.type="new",e.edited=!0,e.showLicense=!1,e.showGitIgnore=!1,e.gitLicense="no",e.gitIgnore="no",e.checkEdited=!0,e.previewed=!1,e.previewed_data="",e.is_markdown=!1,e.message="",e.tree_url=n.$$path.replace("/new/","/tree/"),e.file={title:n.search().filename||"",content:""},l=n.path(),d=l.substring(l.search("/git/new/")+9,l.length),u=ace.require("ace/ext/modelist"),e.DEPOT===!1?void(e.empty=!0):("README.md"===e.file.title?e.file.content="#"+e.PROJECT.name+"\n":"license"===e.file.title.toLowerCase()?(e.showLicense=!0,e.showGitIgnore=!1):".gitignore"===e.file.title?(e.showLicense=!1,e.showGitIgnore=!0):(e.showLicense=!1,e.showGitIgnore=!1),r.new_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},function(t){e.path=encodeURIComponent(t.data.path).replace(/%2F/g,"/"),e.ref=t.data.ref,e.lastCommit=t.data.lastCommit,e.render_url=e.PROJECT.project_path+"/git/blob/"+e.ref+"/"+decodeURIComponent(e.path),a.set(o("i18n")("new_file","code_edit")+t.data.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0,s()}),s=function(){var t,n;return n=o("i18n")("confirm_leave","code_edit"),t=function(){return e.checkEdited&&e.edited?n:void 0},$(window).on("beforeunload",t),e.$on("$locationChangeStart",function(t){e.checkEdited&&e.edited&&!window.confirm(n)&&t.preventDefault()}),e.$on("$routeChangeStart",function(e){$(window).off("beforeunload",t)})},e.preview_md=function(){return r.blobPreview({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},{data:e.data},function(t){return 0===t.code?(e.previewed_data=t.data.replace(/{{CodingUrl}}/g,n.path()),e.previewed=!0):void 0})},e.close_preview=function(){return e.previewed=!1},c=function(e){return new RegExp(/.*(md|mdown|mkdown|markdown|mkdn)$/i).test(e)},e.changeLicense=function(t){return"no"===t?void(e.file.content=""):void r.getLicense({filename:t},function(t){e.file.content=t.data})},e.changeGitIgnore=function(t){return"no"===t?void(e.file.content=""):r.getGitIgnore({filename:t},function(t){return e.file.content=t.data})},e.aceSettings={useWrapMode:!0,theme:"tomorrow",showGutter:!0,onLoad:function(e){e.getSession().setOption("useWorker",!1)},onChange:function(t){var n;n=t[1],e.data=n.getValue()}},e.checkTitle=function(){"license"===e.file.title.toLowerCase()?(e.showLicense=!0,e.showGitIgnore=!1):".gitignore"===e.file.title?(e.showLicense=!1,e.showGitIgnore=!0):(e.showLicense=!1,e.showGitIgnore=!1),e.edited=0!==e.file.title.length&&0!==e.file.content.length,e.is_markdown=c(e.file.title)},e.submit=function(a){return e.checkEdited=!1,0!==e.file.title.length?/^[a-zA-Z0-9\u4e00-\u9fa5\.\/_-]+$/.test(e.file.title)?e.file.title.match(/(?:^[.\/]+[\/])|(\/{2,})|(\.{2,}\/*)|(\/\.\/)|(\/$)/)?void i.fail().send(o("i18n")("file_name_invalid","code_edit")):(0===a.length?e.message="new file "+e.file.title:e.message=a,r.create_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(d)},{title:e.file.title,content:e.file.content,message:e.message,lastCommitSha:e.lastCommit},function(t){return e.render_url.lastIndexOf("/")+1===e.render_url.length?e.render_url=e.render_url+e.file.title:e.render_url=e.render_url+"/"+e.file.title,n.path(e.render_url),i.success().send(o("i18n")("option_successfully","code_edit"))})):void i.fail().send(o("i18n")("file_name_invalid","code_edit")):void 0})},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","PageTitle","Flash","$filter"],e.exports=a.module("git.edit.new",[]).controller("NewFileInGitController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c,u,d,l){var m,f,p,h,g,_,v,w,b;e.inner_menu="basic",e.tag_menu="basic",e.type="upload",e.droppedFiles={},e.message="",e.tree_url=n.$$path.replace("/upload/","/tree/"),e.submitting=!1,e.submitProgress=0,b=n.path(),w=b.substring(b.search("/git/upload/")+12,b.length),r.upload_tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(w)},function(t){e.path=encodeURIComponent(t.data.path).replace(/%2F/g,"/"),e.ref=t.data.ref,e.lastCommit=t.data.lastCommit,e.render_url=e.PROJECT.project_path+"/git/blob/"+e.ref+"/"+decodeURIComponent(e.path),a.set(l("i18n")("upload_file_to","code_upload")+t.data.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0,m()}),g=function(){var t;return t=o.find("#commit-message")[0].value||"",
e.droppedFiles&&Object.keys(e.droppedFiles).length>0||t&&t.length>0},m=function(){var t,n;return n=l("i18n")("confirm_leave","code_upload"),t=function(){return g()&&!e.submitting?n:void 0},$(window).on("beforeunload",t),e.$on("$locationChangeStart",function(t){!g()||e.submitting||window.confirm(n)||t.preventDefault()}),e.$on("$routeChangeStart",function(e){$(window).off("beforeunload",t)})},e.submit=function(r){var a,o,s,c,u,d,m,f,p;if(Object.keys(e.droppedFiles).length<=0)return void i.fail().send(l("i18n")("select_file","code_upload"));c=e.droppedFiles;for(s in c){if(a=c[s],!/^[a-zA-Z0-9\u4e00-\u9fa5\.\/_-]+$/.test(s))return void i.fail().send(l("i18n")("file_name_invalid","code_upload"));if(s.match(/(?:^[.\/]+[\/])|(\/{2,})|(\.{2,}\/*)|(\/\.\/)|(\/$)/))return void i.fail().send(l("i18n")("file_name_invalid","code_upload"))}if(0===r.length)return void i.fail().send(l("i18n")("input_commit_message","code_upload"));m=0,u=e.droppedFiles;for(s in u)a=u[s],m+=a.size;if(m>104857600)return void i.fail().send(l("i18n")("total_size_100m","code_upload"));f="/api/user/"+t.username+"/project/"+t.project_name+"/git/upload/"+encodeURIComponent(w),o=new FormData,d=e.droppedFiles;for(s in d)a=d[s],o.append("files",a,s);return o.append("message",r),o.append("lastCommitSha",e.lastCommit),e.submitting=!0,p=new XMLHttpRequest,p.upload.addEventListener("progress",function(t){var n;if(t.lengthComputable!==!1)return n=Math.round(100*t.loaded/t.total),e.submitProgress=n},!1),p.addEventListener("load",function(t){var a,o,s,c;if(200===t.target.status){if(a=JSON.parse(t.target.response),0===a.code)return i.success().send(l("i18n")("option_successfully","code_upload")),n.path(e.tree_url);if(a.msg){e.submitting=!1,s=a.msg,c=[];for(o in s)r=s[o],c.push(i.fail().send(r));return c}}else switch(e.submitting=!1,t.target.status){case 500:return i.fail().send("服务器内部错误，有人要扣奖金了～");case 502:return i.fail().send("服务器正在更新，请稍后再试。");case 504:return i.fail().send("服务器正在更新，请稍后再试。");case 400:return i.fail().send("服务器/页面接口请求不匹配，前端要扣工资了～");case 404:return i.fail().send("请求的数据接口不存在")}},!1),p.open("POST",f),p.send(o)},f=function(e,t){return t.size<=0?(i.warn().send(l("i18n")("ignore_empty_file","code_upload",e)),!1):t.size>20971520?(i.warn().send(l("i18n")("ignore_large_than_20m","code_upload",e)),!1):!0},e.addDroppedFile=function(t,n){return f(t,n)?e.droppedFiles[t]=n:void 0},e.removeDroppedFile=function(t){return delete e.droppedFiles[t]},v=u.gitUploadFilesDroppedOnTreePage;for(_ in v)p=v[_],e.addDroppedFile(_,p);return delete u.gitUploadFilesDroppedOnTreePage,(h=function(){var t,n,r,a,i;return s.gitUploadDropZoneTimeout=null,a=function(){var e;return e=o.find("#git_upload_dragenter"),e.dimmer("is animating")|e.dimmer("is active")},n=function(e){var t,n,r,i,u;for(e.preventDefault(),t=o,r=o.find("#git_upload_dragenter"),u=s.gitUploadDropZoneTimeout,u||a()?c.cancel(u):r.dimmer("show"),n=!1,i=e.target;;){if(i===t[0]){n=!0;break}if(i=i.parentNode,null!==i)break}return n?a()||r.dimmer("show"):r.dimmer("hide"),s.gitUploadDropZoneTimeout=c(function(){return s.gitUploadDropZoneTimeout=null,r.dimmer("hide")},100)},o.bind("dragover",n),i=function(t,n){var r;return n=n||"",t.isFile?t.file(function(t){var r;return r=n+t.name,e.addDroppedFile(r,t)}):t.isDirectory?(r=t.createReader(),r.readEntries(function(e){var r,a,o,s;for(s=[],a=0,o=e.length;o>a;a++)r=e[a],s.push(i(r,n+t.name+"/"));return s})):void 0},t=function(t){var n,r,a,o,s,c,u,d,l,m;if(o=t.originalEvent.dataTransfer.items,o&&o.length&&o[0].webkitGetAsEntry){for(l=[],r=0,c=o.length;c>r;r++)a=o[r],n=a.webkitGetAsEntry(),n?l.push(i(n)):l.push(void 0);return l}for(d=t.originalEvent.dataTransfer.files,m=[],s=0,u=d.length;u>s;s++)p=d[s],m.push(e.addDroppedFile(p.name,p));return m},r=function(n){n.preventDefault(),t(n),e.$apply()},o.bind("drop",r),e.$on("$destroy",function(){return o.unbind("dragover",n),o.unbind("drop",r)})})()},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","PageTitle","Flash","$document","$window","$timeout","$rootScope","$http","$filter"],e.exports=a.module("git.edit.upload",[]).controller("UploadFileInGitController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c;return e.inner_menu="basic",e.tag_menu="basic",s=function(){var t,n,a;return t=/^\/(u|t)\/[^\/]+\/p\/[^\/]+\/git[\/]?$/,a=r.path(),t.test(a)&&(a=a+"/tree/"+e.DEPOT.default_branch),n=a.substring(a.search("/git/find/")+10,a.length)},e.ref=s()||e.DEPOT.default_branch||"",e.loaded=!1,e.finderField="",e.filteredTreeList=[],e.resultPointer=0,e.isFinderKeyEvent=!1,e.showKeyboardHelpMessage=!0,e.keyboradHelpMessage=i("i18n")("keyboard_help","code_find_file"),c=[],o=e.finderField,n.treeList({username:t.username,project_name:t.project_name,ref:e.ref},function(t){return t&&0===t.code&&t.data.length?(c=t.data,e.find(""),e.loaded=!0):void 0}),e.reactFinderKeyEvent=function(t){var n,i;switch(e.isFinderKeyEvent=!0,t.which){case 27:return r.path(e.PROJECT.project_path+"/git/tree/"+e.ref);case 13:if(e.filteredTreeList[e.resultPointer]&&(i=e.PROJECT.project_path+"/git/blob/"+e.ref+"/"+e.filteredTreeList[e.resultPointer].path,e.filteredTreeList.length>0))return r.path(i);break;case 38:if(t.preventDefault(),e.resultPointer>0)return e.resultPointer=e.resultPointer-1;break;case 40:if(t.preventDefault(),n=e.filteredTreeList.length>50?50:e.filteredTreeList.length,n>e.resultPointer+1)return e.resultPointer=e.resultPointer+1;break;default:return e.resultPointer=0,a.scrollTo(0,0)}},e.mouseHoverResultItem=function(t){return e.isFinderKeyEvent=!1,e.resultPointer=t},e.find=function(t){var n;return t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp("("+t+")","ig"),e.filteredTreeList=c.filter(function(e){return e.search(n)>=0}).map(function(e){return{path:e,html:e.replace(n,"<strong>$&</strong>")}})},e.hideKeyboardHelpMessage=function(){return e.showKeyboardHelpMessage=!1}},a=n(1),r.$inject=["$scope","$routeParams","Depot","location","$window","$filter"],e.exports=a.module("git.find",[]).controller("FindController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c,u;return e.public_view=!1,e.PROJECT.is_public&&(e.public_view=!0),e.loaded=!1,e.list=[],e.rootDepot=null,r.set("Forks 列表",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),c=e.pager_id="forks:"+(new Date).getTime(),o=a.instance(c,e),s=o.onChange().then(null,null,function(t){return e.loadData(t)}),e.loadData=function(r){return e.loaded=!1,n.forks_paging({username:t.username,project_name:t.project_name,page:r,pageSize:10},function(t){return o.optionsReady(t.data),e.list=t.data.list,u(),e.loaded=!0})},n.forks_paging({username:t.username,project_name:t.project_name,page:1,pageSize:1},function(t){return e.rootDepot=t.data.list[0],u()}),u=function(){return e.rootDepot&&e.list[0]&&e.rootDepot.id!==e.list[0].id?e.list.unshift(e.rootDepot):void 0},e.loadData(o.currentPage())},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","$rootScope"],e.exports=a.module("git.public.forks",[]).controller("ForksController",r)},function(e,t,n){"use strict";var r;r=n(1),e.exports=r.module("git",[n(64).name,n(8).name,n(7).name,n(13).name,n(12).name,n(14).name,n(50).name,n(49).name,n(39).name,n(33).name,n(34).name,n(32).name,n(31).name,n(10).name,n(11).name,n(9).name,n(62).name,n(63).name,n(43).name,n(46).name,n(47).name,n(44).name,n(87).name,n(45).name,n(2).name,n(51).name,n(52).name,n(54).name,n(53).name,n(61).name,n(65).name,n(36).name,n(25).name,n(16).name,n(27).name,n(22).name,n(21).name,n(23).name,n(24).name,n(17).name,n(20).name,n(15).name,n(19).name,n(18).name,n(30).name,n(29).name,n(28).name,n(26).name,n(48).name,n(35).name,n(56).name,n(57).name,n(58).name,n(55).name,n(59).name,n(60).name])},,function(e,t,n){"use strict";var r,a,i,o;r=n(41),i=n(42),a=function(e,t,n,a){return e.inner_menu="stat",e.tag_menu="stat",e.type="stat",e.isHead=!1,e.loaded=!1,e.empty=!1,e.blob=[],e.ref=[],e.path=[],e.current_branch=t.region||e.DEPOT.default_branch,e.DEPOT===!1?void(e.empty=!0):(a.listBranches({username:t.username,project_name:t.project_name},function(t){return e.branches=t.data}),a.getGraph({username:t.username,project_name:t.project_name,region:encodeURIComponent(e.current_branch)},function(t){var n,a;return e.data=t.data,n=e.data,a=new r,a.init(n),$("#brush_change").change(function(){return a.change_date_header(),a.redraw_authors()}),e.loaded=!0})["catch"](function(t,r){return n.path(e.PROJECT.project_path+"/git")}),e.changeCurrentBranch=function(t){return n.path(e.PROJECT.project_path+"/git/graph/"+t)})},o=n(1),a.$inject=["$scope","$routeParams","$location","Depot"],e.exports=o.module("git.graph",[]).controller("GraphGitController",a)},function(e,t){var n;n={parse_log:function(e){var t,n,r,a,i;for(i={},t={},r=0,a=e.length;a>r;r++)n=e[r],null==i[n.date]&&this.add_date(n.date,i),null==t[n.author_name]&&this.add_author(n,t),t[n.author_name][n.date]||this.add_date(n.date,t[n.author_name]),this.store_data(n,i[n.date],t[n.author_name][n.date]);return i=_.toArray(i),t=_.toArray(t),{total:i,by_author:t}},add_date:function(e,t){return t[e]={},t[e].date=e},add_author:function(e,t){return t[e.author_name]={},t[e.author_name].author_name=e.author_name,t[e.author_name].author_email=e.author_email},store_data:function(e,t,n){return this.store_commits(t,n),this.store_additions(e,t,n),this.store_deletions(e,t,n)},store_commits:function(e,t){return this.add(e,"commits",1),this.add(t,"commits",1)},add:function(e,t,n){return null==e[t]&&(e[t]=0),e[t]+=n},store_additions:function(e,t,n){return null==e.additions&&(e.additions=0),this.add(t,"additions",e.additions),this.add(n,"additions",e.additions)},store_deletions:function(e,t,n){return null==e.deletions&&(e.deletions=0),this.add(t,"deletions",e.deletions),this.add(n,"deletions",e.deletions)},get_total_data:function(e,t){var n,r;return n=e.total,r=this.pick_field(n,t),_.sortBy(r,function(e){return e.date})},pick_field:function(e,t){var n;return n=[],_.each(e,function(e){return n.push(_.pick(e,[t,"date"]))}),n},get_author_data:function(e,t,n){var r,a;return null==n&&(n=null),a=e.by_author,r=[],_.each(a,function(e){return function(a){var i;return i=e.parse_log_entry(a,t,n),_.isEmpty(i.dates)?void 0:r.push(i)}}(this)),_.sortBy(r,function(e){return e[t]}).reverse()},parse_log_entry:function(e,t,n){var r;return r={},r.author_name=e.author_name,r.author_email=e.author_email,r.dates={},r.commits=r.additions=r.deletions=0,_.each(_.omit(e,"author_name","author_email"),function(e){return function(a,i){return e.in_range(a.date,n)?(r.dates[a.date]=a[t],r.commits+=a.commits,r.additions+=a.additions,r.deletions+=a.deletions):void 0}}(this)),r},in_range:function(e,t){var n;return null===t||t[0]<=(n=new Date(e))&&n<=t[1]?!0:!1}},e.exports=n},function(e,t,n){var r,a,i,o,s;s=n(40),a=n(4).ContributorsGraph,i=n(4).ContributorsMasterGraph,r=n(4).ContributorsAuthorGraph,o=function(){function e(){}return e.prototype.init=function(e){var t,n;return this.parsed_log=s.parse_log(e),this.set_current_field("commits"),n=s.get_total_data(this.parsed_log,this.field),t=s.get_author_data(this.parsed_log,this.field),this.add_master_graph(n),this.add_authors_graph(t),this.change_date_header()},e.prototype.add_master_graph=function(e){return this.master_graph=new i(e),this.master_graph.draw()},e.prototype.add_authors_graph=function(e){var t;return this.authors=[],t=e.slice(0,100),_.each(t,function(e){return function(t){var n,a;return a=e.create_author_header(t),$(".contributors-list").append(a),e.authors[t.author_name]=n=new r(t.dates),n.draw()}}(this))},e.prototype.format_author_commit_info=function(e){var t;return t=$("<span/>",{"class":"graph-author-commits-count"}),t.text(e.commits+" commits"),$("<span/>").append(t)},e.prototype.create_author_header=function(e){var t,n,r,a;return a=$("<li/>",{"class":"person",style:"display: block;"}),r=$("<h4>"+e.author_name+"</h4>"),n=$("<span/>",{"class":"commits"}),t=this.format_author_commit_info(e),n.html(t),a.append(r),a.append(n),a},e.prototype.redraw_master=function(){var e;return e=s.get_total_data(this.parsed_log,this.field),this.master_graph.set_data(e),this.master_graph.redraw()},e.prototype.redraw_authors=function(){var e,t;return $("ol").html(""),t=a.prototype.x_domain,e=s.get_author_data(this.parsed_log,this.field,t),_.each(e,function(e){return function(t){return e.redraw_author_commit_info(t),$(e.authors[t.author_name].list_item).appendTo("ol"),e.authors[t.author_name].set_data(t.dates),e.authors[t.author_name].redraw()}}(this))},e.prototype.set_current_field=function(e){return this.field=e},e.prototype.change_date_header=function(){var e,t;return t=a.prototype.x_domain,e=moment(t[0]).format("LL")+" - "+moment(t[1]).format("LL"),$("#date_header").text(e)},e.prototype.redraw_author_commit_info=function(e){var t,n;return n=$(this.authors[e.author_name].list_item),t=this.format_author_commit_info(e),n.find("span").html(t)},e}(),e.exports=o},function(e,t){var n;n=function(){function e(){}return e.log={},e.get_log=function(){return this.log},e.set_log=function(e){return this.log=e},e}(),e.exports=n},function(e,t,n){"use strict";var r,a,i;a=n(2),r=function(e,t,n,r,a,o,s,c,u,d,l){var m,f,p,h,g,v,w,b,C;return e.inner_menu="merge",e.tag_menu="merge",e.loaded=!1,e.keyword=s.search().q,e.filterKeys=["sort","reviewer","merger","creator","tag","status"],e.filters={status:{title:l("i18n")("merge_status","code_merge"),data:[{key:"_default",value:l("i18n")("default","code_merge"),selected:!0,excluded:!0},{key:"canmerge",value:l("i18n")("can_merge","code_merge"),excluded:!0},{key:"cannotmerge",value:l("i18n")("cannot_auto_merge","code_merge"),excluded:!0},{key:"refused",value:l("i18n")("refused","code_merge"),excluded:!0},{key:"accepted",value:l("i18n")("merged","code_merge"),excluded:!0}],type:"plainText",result:s.search().status||"_default"},tag:{title:l("i18n")("label","code_merge"),data:[],type:"tag",result:s.search().tag||"_default"},creator:{title:l("i18n")("creator","code_merge"),data:[],type:"user",result:s.search().creator||"_default"},merger:{title:l("i18n")("merger","code_merge"),data:[],type:"user",result:s.search().merger||"_default"},reviewer:{title:l("i18n")("reviewer","code_merge"),data:[],type:"user",result:s.search().reviewer||"_default"},sort:{title:l("i18n")("sort","code_merge"),data:[{key:"_default",value:l("i18n")("default","code_merge"),selected:!0,excluded:!0},{key:"created_at",value:l("i18n")("create_time","code_merge"),excluded:!0},{key:"merged_at",value:l("i18n")("merge_time","code_merge"),excluded:!0},{key:"updated_at",value:l("i18n")("update_time","code_merge"),excluded:!0}],type:"sort",result:s.search().sort||"_default"}},b={CANMERGE:{"class":"thumbs up outline icon",alert:l("i18n")("can_merge","code_merge")},CANNOTMERGE:{"class":"exclamation icon",alert:l("i18n")("cannot_auto_merge","code_merge")},REFUSED:{"class":"remove icon",alert:l("i18n")("refused","code_merge")},ACCEPTED:{"class":"coding merge-request icon",alert:l("i18n")("merged","code_merge")},CANCEL:{"class":"remove sign icon",alert:l("i18n")("canceled","code_merge")},GRANTED:{"class":"thumbs up icon",alert:l("i18n")("granted","code_merge")}},f=function(e,t){var n;return"status"===t?b[e.result.toUpperCase()].alert:"tag"===t?(n=_.find(e.data,function(t){return t.key===e.result}),null!=n?n.value:void 0):"sort"===t?(n=_.find(e.data,function(t){return t.key===e.result}),null!=n?n.value:void 0):e.result.replace(/[\d]+:/g,"")},C=function(){var t;return t="",i.forEach(e.filters,function(e,n){return"_default"!==e.result?(""!==t&&(t+=" | "),t+=e.title+": "+f(e,n)):void 0}),e.keyword&&""!==e.keyword&&(""!==t&&(t=" | "+t),t=l("i18n")("key_word","code_merge")+"："+e.keyword+t),e.filterTitle=t},e.statusIcon=function(e){var t;return t="ACCEPTED"!==e.merge_status&&e.granted?"GRANTED":e.merge_status,b[t]},e.statusPopupOptions={className:{popup:"ui popup"},variation:"small inverted",position:"top center",transition:"fade up",closable:!0,on:"hover"},e.doFilter=function(t){return("merger"===t||"sort"===t&&"merged_at"===e.filters.sort.result)&&(e.filters.status.result="accepted"),"sort"===t&&s.skipReload().search("page",null),"status"===t&&"accepted"!==e.filters.status.result&&(e.filters.merger.result="_default",e.filters.sort.result="_default"),i.forEach(e.filters,function(e,t){return"_default"!==e.result?s.skipReload().search(t,e.result.replace(/[\d]+:/g,"")):s.skipReload().search(t,null)}),h(s.search().page||1)},e.clearFilter=function(){return s.skipReload().search(""),i.forEach(e.filters,function(e,t){return e.result="_default"}),e.keyword="",h(1)},e.showClearFilter=function(){var e;return e=s.search(),e.q||e.status||e.creator||e.merger||e.reviewer||e.sort||e.tag},e.updateSearch=function(){return s.skipReload().search("q",e.keyword),h(1)},e.mrClick=function(e,t){return"CANCEL"===e.merge_status?(u.warn().send(l("i18n")("canceled_mr","code_merge")),t.preventDefault()):void 0},g=function(){var t;return t=c.defer(),r.members({id:e.PROJECT.id},function(n){var r,a,o,s;return a=[],o=[],s=[],r=function(t){return a.push(i.extend({selected:t.key===e.filters.creator.result},t)),o.push(i.extend({selected:t.key===e.filters.merger.result},t)),s.push(i.extend({selected:t.key===e.filters.reviewer.result},t))},r({key:"_default",value:l("i18n")("all_people","code_merge"),excluded:!0}),r({key:e.USER.global_key,avatar:e.USER.avatar,value:e.USER.global_key,excluded:!0,pinyin:e.USER.name_pinyin}),n.data.list.forEach(function(t){var n;return n=t.user,n.id!==e.USER.id?r({key:n.global_key,avatar:n.avatar,value:n.global_key,excluded:!0,pinyin:n.name_pinyin}):void 0}),e.filters.creator.data=a,e.filters.merger.data=o,e.filters.reviewer.data=s,t.resolve()}),t.promise},v=function(){var t;return t=c.defer(),r.tags({id:e.PROJECT.id,withCount:!1},function(n){var r,a;return r=function(t){return a.push(i.extend({selected:t.key===e.filters.tag.result},t))},a=[],r({key:"_default",value:l("i18n")("default","code_merge"),excluded:!0}),n.data.forEach(function(e){return r({key:""+e.id,value:e.name,excluded:!0,color:e.color})}),e.filters.tag.data=a,t.resolve()}),t.promise},w=e.pager_id=(new Date).getTime(),m=a.instance(w,e),h=function(r,a){return null==a&&(a=!0),a&&C(),e.loaded=!1,n.merge_request_filter({username:t.username,project_name:t.project_name,status:s.search().status,creator:s.search().creator,merger:s.search().merger,reviewer:s.search().reviewer,sort:s.search().sort,label:s.search().tag,q:s.search().q,page:r},function(t){return e.merges=t.data,m.optionsReady(t.data),e.loaded=!0})},m.onChange(function(e){h(e)}),c.all([v(),g()]).then(function(){return C()}),h(1,!1),e.getMergeStatusClass=function(e){return o.getMergeStatusClass(e)},e.getMergeStatusHuman=function(e){return o.getMergeStatusHuman(e)},e.status=s.$$search.status||"open",e.getFilterByCenter=function(){var t,n;return"open"===e.status?t=l("i18n")("unhandled","code_merge"):"closed"===e.status?n=l("i18n")("handled","code_merge"):void 0},e.getFilter=function(){var t;return"open"===e.status?t=l("i18n")("unhandled","code_merge"):"closed"===e.status?t=l("i18n")("handled","code_merge"):void 0},e.auto_lint=!1,p=function(){return d.get_lint_settings({username:t.username,project_name:t.project_name,items:"auto_lint"},function(t){return t&&0===t.code?e.auto_lint="true"===t.data.auto_lint:void 0})},e.submitAutoLint=function(e){return d.set_lint_settings({username:t.username,project_name:t.project_name},{auto_lint:e?"true":"false"},function(e){return p()})},p()},i=n(1),r.$inject=["$scope","$routeParams","Depot","Project","Pager","MergeRequestService","$location","$q","Flash","Lint","$filter"],e.exports=i.module("git.merge.index",[]).controller("MergeRequestIndexController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a){return e.merge_options={delSourceBranch:a.mr_del_src_branch||!1,fastforward:a.mr_fastforward||!1},e.$on("merge-request.merge.sync",function(){return e.merge_request=e.$parent.merge_request,e.squash=e.$parent.squash.squash_before_merge}),e.merge=function(i){return e.loaded=!1,t.merge_request_merge({username:n.username,project_name:n.project_name,iid:n.iid,message:i.commit_message,del_source_branch:e.merge_options.delSourceBranch,fastforward:e.merge_options.fastforward,squash:e.squash},{},function(t){return e.$parent.mergeRequestMergeModal.action("hide"),r.reload(),a.mr_del_src_branch=e.merge_options.delSourceBranch,a.mr_fastforward=e.merge_options.fastforward,a.mr_squash=e.squash})["catch"](function(t,n){e.loaded=!0})}},a=n(1),r.$inject=["$scope","Depot","$routeParams","$route","$localStorage"],e.exports=a.module("git.merge.merge",[]).controller("MergeRequestMergeModalCtrl",r)},function(e,t,n){"use strict";var r,a;r=n(2),a=function(e,t){return function(e){return t.getMergeStatusHuman(e)}},a.$inject=["$window","MergeRequestService"],e.exports=angular.module("git.merge.filter.mergeStatusHuman",[]).filter("mergeStatusHuman",a)},function(e,t,n){"use strict";var r,a,i;a=n(2),r=function(e,t,n,r,a,i,o,s,c,u){var d,l,m,f;return e.location=n,e.inner_menu="merge",e.tag_menu="merge",e.reviewers=[],e.showDiff=!1,e.can_merge=!0,e.loaded=!1,e.submiting=!1,e.diffMode=t.diff||r("diff_mode")||"",""!==e.diffMode&&r("diff_mode",e.diffMode,{path:"/",expires:365}),e.mr_create={srcBranch:t.startWith||"",desBranch:t.endWith||e.DEPOT.default_branch||"",title:"",content:""},a.set(u("i18n")("new_merge_request","code_merge"),e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.members=[],l=o.membersWithType({project_id:e.PROJECT.id,type:e.MEMBER}),l.then(function(t){return 0===t.code?e.members=t.data:void 0}),d=i.branches(t.username,t.project_name),d.then(function(t){return e.branches=t.data}),""!==e.mr_create.srcBranch&&""!==e.mr_create.desBranch&&(e.showDiff=!1,e.loaded=!0,e.diffStat="",e.diffHtml="",e.commits="",m=i.mergeRequestCreate(t.username,t.project_name,e.mr_create.srcBranch,e.mr_create.desBranch,e.diffMode,t.w),m.then(function(n){return e.diffStat=n.data.merge_request.diffStat,e.diffHtml=n.data.merge_request.htmlDiff,e.commits=n.data.merge_request.commits,e.commits&&e.commits.length>0&&(e.commitId=e.commits[0].commitId,e.baseCommitId=e.commits[e.commits.length-1].commitId),e.showDiff=!0,e.loaded=!1,e.can_merge=!0,e.mr_create.content="",e.commits.length<=0&&(e.can_merge=!1,e.showDiff=!1),e.switchTab(t.tab||"commits")})),e.createMergeRequest=function(e,t){return""!==e&&""!==t?n.search({startWith:e,endWith:t}):void 0},e.submitMergeRequest=function(r){var a,o,s,c,u;return e.submiting=!0,(null!=(o=e.reviewers)?o.length:void 0)>0&&(c=_.map(e.reviewers,"global_key"),c=c.join(","),$.extend(r,{reviewers:c})),(null!=(s=e.tasks)?s.length:void 0)>0&&(u=_.map(e.tasks,"code"),u=u.join(","),$.extend(r,{tasks:u})),a=i.mergeRequestSubmit(t.username,t.project_name,r),a.then(function(t){return n.url(t.data.merge_request.path),e.submiting=!1}),a["catch"](function(t,n){e.submiting=!1})},e.contentUpdate=function(t){e.mr_create.content=t},e.switchTab=function(t){return e.show_diff=t,"commits"===t&&(t=void 0),n.skipReload().search("tab",t)},e.task_select="",e.tasks=[],$("#mr_task_select").select2({placeholder:u("i18n")("please_select","code_merge"),width:"250px",minimumInputLength:1,ajax:{url:"/api/user/"+t.username+"/project/"+t.project_name+"/resource/search",dataType:"json",delay:250,data:function(e){return{q:e,type:"Task",pageSize:6}},results:function(e){return{results:f(e.data.list)}},cache:!0},formatResult:function(e){var t;return t=[],t.push("<div class='ellipsis'><i class='icon tasks'>"),t.push("</i><span style='color: #666'>#"+e.code+"</span>"),t.push("<span style='padding-left: 10px;font-weight: bold;' class='ellipsis'>"+e.title+"</span></div>"),t.join("")},formatSelection:function(e){var t;return t=[],t.push("<div class='ellipsis'><i class='icon tasks'>"),t.push("</i><span style='color: #666'>#"+e.code+"</span>"),t.push("<span style='padding-left: 10px;font-weight: bold;' class='ellipsis'>"+e.title+"</span></div>"),t.join("")},dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e}}),$("#mr_task_select").on("change",function(){return e.task_select=$(this).select2("val"),$(this).select2("val",""),c.resourceByCode({username:t.username,project_name:t.project_name,code:e.task_select},function(t){var n;return(n=_.find(e.tasks,function(e){return e.code===t.data.code}))?void 0:e.tasks.push(t.data)})}),e.task_remove=function(t){return _.remove(e.tasks,t)},f=function(e){return e instanceof Array?$.each(e,function(e,t){return t.id=t.code}):void 0},e.$on("$destroy",function(){return $("#mr_task_select").select2("destroy"),$("#mr-reviewer-select").select2("destroy")})},i=n(1),r.$inject=["$scope","$routeParams","location","ipCookie","PageTitle","MergeRequestService","Project","Common","Search","$filter"],e.exports=i.module("git.merge.new",[]).controller("MergeRequestNewController",r)},function(e,t,n){"use strict";var r,a,i;r=n(2),a=function(e,t,n,r,a,o,s,c,u,d,l,m,f,p,h,g){var v,w,b,C,y,R,j,P,x;return e.inner_menu="merge",e.tag_menu="merge",e.loaded=!1,e.show_diff="comment",e.comments_loaded=!1,e.squashing=!1,e.squash={squash_before_merge:l.mr_squash===!0},e.showMergeRequestActivity=!0,e.ignoreWhitespace="1"===n.w,e.enableWhitespace=!0,e.merge_request={},e.merge_request_title="",e.comment={content:""},e.comments=[],e.reloadComments=!1,e.reviewer_select="0",e.diffMode=n.diff||m("diff_mode")||"",""!==e.diffMode&&m("diff_mode",e.diffMode,{path:"/",expires:365}),e.lint_task_stat="_NotLoaded",e.lintNotes=[],e.lintNotesLoaded=!1,e.popupOptions={className:{popup:"ui popup"},variation:"small inverted",position:"bottom center",transition:"fade down",closable:!0,on:"hover"},v=null,x=e.$watch("merge_request",function(t){i.isDefined(t)&&(v="merge_request_"+t.iid,e.comment.content=l[v],x&&x())}),P=function(t){var n,r;return n=[],r=!1,i.forEach(e.comments,function(e){return r?n.push(e):(i.forEach(e,function(e){return e.id===t?r=!0:void 0}),r?void 0:n.push(e))}),e.comments=n,e.commentCount-=1},b=function(){return e.comments_loaded=!1,r.merge_request_comments_list({username:n.username,project_name:n.project_name,iid:n.iid},function(t){return e.comments=t.data,r.merge_request_activities_list({username:n.username,project_name:n.project_name,iid:n.iid},function(t){var n;return e.activities=t.data,n=0,i.forEach(e.comments,function(e){return n+=e.length}),i.forEach(e.activities,function(t){return e.comments.push(new Array(t))}),e.comments=_.sortBy(e.comments,function(e){return e[0].created_at}),e.commentCount=n+e.activities.length,e.comments_loaded=!0,e.reloadComments=!1})})},e.$watch(e.comment.content,function(e,t){return e!==t&&v&&""!==e?l[v]=e:void 0}),e.showEditContentIcon=function(e,t){return e&&t&&t.author?"CANMERGE"!==t.merge_status&&"CANNOTMERGE"!==t.merge_status?!1:""===t.body||t.body_plan?""!==t.body&&t.body_plan?!0:""===t.body?!0:void 0:!1:!1},y=function(){return c.tags({id:e.PROJECT.id,withCount:!1},function(t){return e.tags=t.data})},e.onTagAdd=function(e){return r.merge_request_add_label({username:n.username,project_name:n.project_name,iid:n.iid},{label_id:e.id})},e.onTagRemove=function(e){return r.merge_request_del_label({username:n.username,project_name:n.project_name,iid:n.iid,label_id:e.id})},e.onTagCreate=function(t){var n;if(t.name&&t.color)return n=c.addTag({id:e.PROJECT.id},{name:t.name,color:t.color}),n.then(function(){return y()}),n},r.merge_request_show({username:n.username,project_name:n.project_name,iid:n.iid,diff:e.diffMode,w:e.ignoreWhitespace?"1":""},function(r){return e.merge_request=r.data.merge_request,e.merge_request_title=e.merge_request.title,e.merge_request.project=e.PROJECT,e.commits=r.data.merge_request.commits,e.can_merge=r.data.can_merge,e.can_merge_hint=r.data.can_merge_hint,e.can_edit_src_branch=r.data.can_edit_src_branch,e.can_grant=r.data.can_grant,e.labels=r.data.labels,e.diffStat=e.merge_request.diffStat,e.diffHtml=e.merge_request.htmlDiff,e.atConfig={target:e.merge_request,type:"merge_request_comment",extra:t.PROJECT},e.commits&&e.commits.length>0&&(e.baseCommitId=e.commits[e.commits.length-1].commitId,e.notesParams={commitId:e.commits[0].commitId,comments:r.data.line_notes,noteable_type:"MergeRequestBean",noteable_id:e.merge_request.id,atConfig:e.atConfig},e.editFileBranch=e.merge_request.srcBranch),e.can_edit_src_branch?e.merge_request.delSourceBranch=!0:e.merge_request.delSourceBranch=!1,e.showContent(n.tab||"comments"),w(),e.loaded=!0,t.isExpActive("squash-optimize")?e.shouldForceSquash():void 0}),e.shouldForceSquash=function(){var t;return t=e.merge_request.desBranch,r.branches_names({username:n.username,project_name:n.project_name,name:t},function(n){var r,a,i;return(null!=(a=n.data)&&null!=(i=a.list)?i.length:void 0)&&(r=n.data.list[0],r.name===t&&r.force_squash)?(e.force_squash=!0,e.squash.squash_before_merge=!0):void 0})},y(),b(),e.$watchCollection("current_reviewer",function(){return e.merge_request.id?w():void 0}),w=function(){var t,r,a,i;return t=[],t.push("Accept Merge Request #"+n.iid+" "+e.merge_request.title+" : "),t.push("("+e.merge_request.srcBranch+" -> "+e.merge_request.desBranch+")\n\n"),t.push("Merge Request: "+e.merge_request.title+"\n"),t.push("Created By: @"+e.merge_request.author.name+"\n"),(null!=(a=e.reviewers)?a.length:void 0)>0&&(i=[],i.push("Reviewed By: "),r=!1,$.each(e.reviewers,function(e,t){return 100===t.value?(i.push("@"+t.reviewer.name+" "),r=!0):void 0}),i.push("\n"),r&&t.push(i.join(""))),1===e.merge_request.granted&&e.merge_request.granted_by&&t.push("Approved By: @"+e.merge_request.granted_by.name+"\n"),t.push("Accepted By: @"+e.USER.name+"\n"),t.push("URL: "+(o.protocol()+"://"+o.host()+o.path())),e.merge_request.commit_message=t.join("")},r.merge_request_list_reviewer({username:n.username,project_name:n.project_name,iid:n.iid},function(t){var n;return e.reviewers=t.data.reviewers,e.reviewerUsers=_.map(e.reviewers,"reviewer"),e.volunteerReviewers=t.data.volunteer_reviewers,n=c.membersWithType({project_id:e.PROJECT.id,type:e.MEMBER}),n.then(function(t){var n,r;return 0===t.code?(e.member_users=s.m2u(t.data),_.forEach(e.reviewers,function(t){return _.remove(e.member_users,function(e){return t.reviewer.global_key===e.global_key})}),$("#merge-request-info-select-reviewer").select2({placeholder:"请选择",width:"250",formatSelection:function(){return"请选择"},formatResult:function(e){var t;return e.id?"0"===e.id?e.text:(t=[],t.push("<div>"),t.push("<img class='ui image' src='"+$(e.element).attr("data-user-avatar")+"'/>"),t.push("<span class='ellipsis'>"+e.text+"</span>"),t.push("</div>"),t.join("")):e.text},dropdownCssClass:"select-reviewer",matcher:function(e,n,r){var a,o;return n=n.trim(),a=$(r).data("pinyin"),t=0===n.toUpperCase().indexOf(e.toUpperCase()),i.isUndefined(a)?t:(o=a.split("|"),3!==o.length?t:o[1].indexOf(e)>=0||o[2].indexOf(e)>=0||t)}}),r="click."+s.uuid(),n=$(".add-reviewer"),n.on(r,function(){return $("#merge-request-info-select-reviewer").select2("open")}),e.$on("$destroy",function(){return n.off(r)})):void 0}),e.current_reviewer=_.find(e.reviewers,function(t){return t.reviewer.global_key===e.USER.global_key}),i.isUndefined(e.current_reviewer)&&(e.current_reviewer=_.find(e.volunteerReviewers,function(t){return t.reviewer.global_key===e.USER.global_key})),i.isUndefined(e.current_reviewer)?e.current_reviewer={reviewer:e.USER,value:0,volunteer:"volunteer"}:void 0}),e.addReviewer=function(){var t;return"0"!==e.reviewer_select?(t=_.find(e.member_users,function(t){return t.global_key===e.reviewer_select}),r.merge_request_add_reviewer({username:n.username,project_name:n.project_name,iid:n.iid},{user_id:t.id},function(n){var r,a,i;return i=_.find(e.volunteerReviewers,function(e){return e.reviewer.global_key===t.global_key}),_.remove(e.volunteerReviewers,function(e){return e.reviewer.global_key===t.global_key}),_.remove(e.member_users,t),a={value:(null!=i?i.value:void 0)||0,reviewer:t,volunteer:"invitee"},e.reviewer_select="0",e.reviewers.push(a),r={action:"add_reviewer",created_at:Date.now(),author:e.USER,comment:{reviewer:a.reviewer}},e.comments.push([r])})):void 0},e.delReviewer=function(t){return r.merge_request_del_reviewer({
username:n.username,project_name:n.project_name,iid:n.iid,user_id:t.reviewer.id},function(n){var r;return 100===t.value&&(t.volunteer="volunteer",e.volunteerReviewers.push(t)),_.remove(e.reviewers,t),e.member_users.push(t.reviewer),r={action:"del_reviewer",created_at:Date.now(),author:e.USER,comment:{reviewer:t.reviewer}},e.comments.push([r])})},e.onContentChange=function(t){return e.merge_request.body_plan=t},e.edit=function(){return r.merge_request_update_content({username:n.username,project_name:n.project_name,iid:n.iid},{content:e.merge_request.body_plan},function(n){var r;return e.merge_request.body_plan=n.data.body_plan,e.merge_request.body=n.data.body,e.editing=!1,r={action:"update_content",created_at:Date.now(),author:e.USER},e.comments.push([r]),e.commentCount+=1,t.$broadcast("task.detail.change")})},e.editing=!1,e.toggleEditing=function(){return e.editing=!e.editing},e.updateTitle=function(t,a){return a!==e.merge_request.title?(r.merge_request_update_title({username:n.username,project_name:n.project_name,iid:n.iid},{title:a},function(t){var n;return e.merge_request.title=a,n={action:"update_title",created_at:Date.now(),author:e.USER},e.comments.push([n]),e.commentCount+=1}),t&&t.preventDefault(),!1):void 0},R=e.mergeRequestMergeModal=f.instance("merge-request-merge-modal"),j=e.mergeRequestSquashModal=f.instance("merge-request-squash-modal"),e.toggleMergeModal=function(){return"CANMERGE"===e.merge_request.merge_status?(e.$broadcast("merge-request.merge.sync"),R.toggle()):void 0},e.toggleSquashModal=function(){return j.toggle()},e.refuse=function(t){return confirm("确定要拒绝这个 Merge Request 么？")?(e.loaded=!1,r.merge_request_refuse({username:n.username,project_name:n.project_name,iid:n.iid},{},function(e){return a.reload()})["catch"](function(t,n){e.loaded=!0})):void 0},e.cancel=function(t){return confirm("确定要取消这个 Merge Request 么?")?(e.loaded=!1,r.merge_request_cancel({username:n.username,project_name:n.project_name,iid:n.iid},{},function(t){return p.success().send("取消成功"),o.path(e.PROJECT.project_path+"/git/merges")})["catch"](function(t,n){e.loaded=!0})):void 0},e.getMergeStatusClass=function(e){return u.getMergeStatusClass(e)},e.getMergeStatusHuman=function(e){return u.getMergeStatusHuman(e)},e.addComment=function(a){return e.USER?a.length>0?r.add_line_note({username:n.username,project_name:n.project_name},{noteable_type:"MergeRequestBean",noteable_id:e.merge_request.id,content:a},function(n){return e.comments.push([n.data]),e.commentCount+=1,delete l[v],t.$broadcast("task.detail.change")}):void 0:void p.send("请登录后再评论")},e.delComment=function(e){return e&&confirm("请确认删除该评论")?r.del_line_note({username:n.username,project_name:n.project_name,id:e.id},function(t){return P(e.id)}):void 0},e.replyMerges=function(e){return e&&e.author?d.atPerson(e.author.name,"merges-comment-editor"):void 0},e.showContent=function(t){return e.show_diff=t,"comments"===t&&(t=void 0),o.skipReload().search("tab",t),!t&&e.reloadComments?b():void 0},e.onCommentChange=function(t){return e.comment.content=t},t.$on("line-notes.add",function(t,n,r){return 0===r?e.reloadComments=!0:e.commentCount+=1}),t.$on("line-notes.del",function(t,r,a){return 1!==a?e.commentCount-=1:(e.reloadComments=!0,n.tab&&"comments"!==n.tab?void 0:b())}),e.review_submitting=!1,e.reviewGood=function(){return e.review_submitting=!0,r.merge_request_reviewer_good({username:n.username,project_name:n.project_name,iid:n.iid},{},function(){var t;return e.current_reviewer.value=100,"volunteer"===e.current_reviewer.volunteer&&e.volunteerReviewers.push(e.current_reviewer),t={action:"review",created_at:Date.now(),author:e.USER},e.comments.push([t]),e.commentCount+=1})["finally"](function(){return e.review_submitting=!1})},e.reviewGoodUndo=function(){return e.review_submitting=!0,r.merge_request_reviewer_good_undo({username:n.username,project_name:n.project_name,iid:n.iid},{},function(){var t;return e.current_reviewer.value=0,"volunteer"===e.current_reviewer.volunteer&&_.remove(e.volunteerReviewers,e.current_reviewer),t={action:"review_undo",created_at:Date.now(),author:e.USER},e.comments.push([t]),e.commentCount+=1})["finally"](function(){return e.review_submitting=!1})},e.grant_submitting=!1,e.grant=function(){return e.grant_submitting=!0,r.merge_request_grant({username:n.username,project_name:n.project_name,iid:n.iid},{},function(){var t;return e.merge_request.granted=1,t={action:"grant",created_at:Date.now(),author:e.USER},e.comments.push([t]),e.commentCount+=1,w()})["finally"](function(){return e.grant_submitting=!1})},e.grantUndo=function(){return e.grant_submitting=!0,r.merge_request_grant_undo({username:n.username,project_name:n.project_name,iid:n.iid},{},function(){var t;return e.merge_request.granted=0,t={action:"grant_undo",created_at:Date.now(),author:e.USER},e.comments.push([t]),e.commentCount+=1,w()})["finally"](function(){return e.grant_submitting=!1})},e.toggleMergeRequestActivity=function(){return e.showMergeRequestActivity=!e.showMergeRequestActivity},e.getShowMergeRequestActivityIcon=function(e){return e?"icon check-icon empty checkbox processing":"icon check-icon checkmark sign done"},e.getActivityHuman=function(e){var t;return t={create:function(){return"创建了合并请求"},merge:function(){return"合并了合并请求"},refuse:function(){return"拒绝了合并请求"},cancel:function(){return"取消了合并请求"},update:function(){return"编辑合并请求"},review:function(){return"对此合并请求评审 +1"},review_undo:function(){return"撤消了对此合并请求评审 +1"},grant:function(){return"给此合并请求授权了合并权限"},grant_undo:function(){return"撤消了给此合并请求授权了合并权限"},push:function(){return"推送了新的提交，更新了合并请求"},update_title:function(){return"编辑了标题"},update_content:function(){return"编辑了描述"},add_reviewer:function(){return"添加了评审者"},del_reviewer:function(){return"移除了评审者"}},s.smartSwitch(t,e,e)},e.getActivityIcon=function(e){var t;return t={create:function(){return"add"},merge:function(){return"merge-request coding"},refuse:function(){return"exclamation"},cancel:function(){return"close"},update:function(){return"rotate180 align right"},review:function(){return"thumbs up"},review_undo:function(){return"thumbs down"},grant:function(){return"unlock"},grant_undo:function(){return"lock"},push:function(){return"coding-commit coding"},update_title:function(){return"rotate180 align right"},update_content:function(){return"rotate180 align right"},add_reviewer:function(){return"add user basic"},del_reviewer:function(){return"delete user basic"}},s.smartSwitch(t,e,e)},e.showSquash=function(){return e.commits.length>1&&e.merge_request.author.id===t.USER.id},e.beforeSquash=function(){return e.toggleSquashModal()},e.$on("$destroy",function(){return R.remove(),j.remove(),$("#merge-request-info-select-reviewer").select2("destroy")}),C=function(){return h.get_mr_lint_task({username:n.username,project_name:n.project_name,iid:n.iid},function(t){var n;return e.lintNotesLoaded=!1,null==t?(p.fail().send("无法获取合并请求的质量分析数据"),void(e.lintNotesLoaded=!0)):0!==t.code?void(3800===t.code?(e.lint_task_stat="NotFound",e.lintNotesLoaded=!0):(e.lint_task_stat="Unknown",e.lintNotesLoaded=!0)):1===t.data.status?(e.lint_task_stat="Created",e.lintNotesLoaded=!1):2===t.data.status?null!=e.merge_request.diffStat&&e.merge_request.diffStat.commitId===t.data.ref?(e.lint_task_stat="Done",null!=t.data.report&&""!==t.data.report&&(n=JSON.parse(t.data.report),null!=n.notes&&n.notes instanceof Array&&(e.lintNotes=n.notes)),e.lintNotesLoaded=!0):(e.lint_task_stat="_NeededUpdate",e.lintNotesLoaded=!1):3===t.data.status?(e.lint_task_stat="Error",e.lintNotesLoaded=!0):(e.lint_task_stat="Unknown",e.lintNotesLoaded=!0)})},e.$watch("[loaded,lint_task_stat]",function(n,r){if(t.isExpActive("lint")&&n&&n[0]===!0){if("_NotLoaded"===e.lint_task_stat)return C();if("Created"===n[1]||"_NeededUpdate"===n[1])return g(C,5e3)}},!0),e.createLintTask=function(){return t.isExpActive("lint")?h.create_mr_lint_task({username:n.username,project_name:n.project_name,iid:n.iid},{},function(e){return null!=e&&0===e.code?(p.success().send("质量分析任务创建成功"),C()):void 0}):void 0}},i=n(1),a.$inject=["$scope","$rootScope","$routeParams","Depot","$route","location","Common","Project","MergeRequestService","LightMdEditorService","$localStorage","ipCookie","ModalService","Flash","Lint","$timeout"],e.exports=i.module("git.merge.show",[]).controller("MergeRequestShowController",a)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c){var u,d,l,m,f;return e.inner_menu="pages",e.tag_menu="pages",e.pages_enabled=!1,e.current_input={pages_branch:""},e.current_input.pages_current_input_domain="",e.pages_status={},e.deploy_source="选择来源",e.force_ssl=!1,e.show_build_log=!1,e.loaded=!1,e.hasCommits=!0,e.main_entry="",e.original_entry="",e.skipSplashReviewType="image",e.skipSplashReviewImageType=1,e.skipSplashReviewRequesting=!1,r.depot({username:n.username,project_name:n.project_name},function(t){var n,r;return e.hasCommits=t.data.depot.hasCommits,e.hasCommits?(n=c(l,1e4),e.$on("$destroy",function(){return c.cancel(n)}),r=c(m,600500),e.$on("$destroy",function(){return c.cancel(r)})):void 0}),f=function(){return e.deploy_source=function(){switch(e.pages_status.deploy_source_status.current_source){case"coding-pages":return"coding-pages 分支";case"master":return"master 分支";case"master/docs":return"master 分支 / docs 目录";default:return"选择来源"}}()},u=function(e){var t,n,r,a,i,o,s;if(s=e.site,e.primary_domain){for(r=e.certs?e.certs:[],a=0,i=r.length;i>a;a++)t=r[a],t.domain===e.primary_domain&&(n=t);return o=n&&"NORMAL"===n.status&&s.force_ssl?"https://":"http://",o+e.primary_domain}return o=s.force_ssl?"https://":"http://",o+d(e)},d=function(e){var t;return t=e.site,t.global_key+"."+e.common_domain===t.project_name?t.project_name:t.global_key+"."+e.common_domain+"/"+t.project_name},l=function(){return e.pages_enabled?r.getPagesDeployStatus({username:n.username,project_name:n.project_name},function(t){return e.pages_status.task=t.data}):void 0},m=function(t){return r.getPagesStatus({username:n.username,project_name:n.project_name},function(n){e.pages_status=n.data,n.data.site?(f(),e.pages_enabled=!0,e.current_input.pages_branch=e.pages_status.deploy_source_status.current_source,e.force_ssl=e.pages_status.site.force_ssl,e.main_entry=u(n.data),e.original_entry=d(n.data),e.loaded=!0):(e.pages_enabled=!1,e.current_input.pages_branch="none",e.loaded=!0),o.set("Pages 服务",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),t instanceof Function&&t()})},m(),e.saveDeploySource=function(t){if(!t.pages_branch||0===t.pages_branch.length)return void s.fail().send("请选择部署来源");if(t.pages_branch!==e.pages_status.deploy_source_status.current_source)return"none"===t.pages_branch?void(e.pages_status.site&&e.deletePages()):e.pages_status.site?r.savePagesDeploySource({username:n.username,project_name:n.project_name},{source:t.pages_branch},function(e){return s.success().send("保存成功")}):e.openPages(t)},e.openPages=function(e){return r.openPages({username:n.username,project_name:n.project_name},{pages_branch:e.pages_branch},function(e){return m(),s.success().send("开启成功，等待几分钟后即可访问")})},e.deletePages=function(){return r.deletePages({username:n.username,project_name:n.project_name},{},function(t){return e.pages_branch="",e.pages_enabled=!1,m(),s.success().send("关闭成功")})},e.redeployPages=function(){return r.redeployPages({username:n.username,project_name:n.project_name},{},function(e){return m(),s.success().send("已重新部署，等待几分钟后即可访问")})},e.addPagesDomain=function(t){return confirm("请设置 "+t.pages_current_input_domain+" 的 CNAME 记录到 pages.coding.me 后再绑定,是否确认?")?r.addPagesDomain({username:n.username,project_name:n.project_name},{domain:t.pages_current_input_domain},function(t){return m(),e.current_input.pages_current_input_domain="",s.success().send("添加绑定域名成功")}):void 0},e.deletePagesDomain=function(e){return r.deletePagesDomain({username:n.username,project_name:n.project_name},{domain:e},function(e){return m(),s.success().send("删除绑定域名成功")})},e.domainUrl=function(e){return"http://"+e.name},e.setForceSsl=function(t){return r.setForceSsl({username:n.username,project_name:n.project_name},{force_ssl:t},function(n){return m(),e.force_ssl=t,s.success().send("设置成功，10 分钟内生效")})},e.reapplySSLCert=function(e){return confirm("请设置 "+e+" 的 CNAME 记录到 pages.coding.me 后再申请,是否确认?")?r.reapplySSLCert({username:n.username,project_name:n.project_name},{domain:e},function(e){return s.success().send("已经重新申请，请随后检查证书状态")}):void 0},e.pagesUrl=function(){return"http://"+n.username+".coding.me/"+n.project_name},e.changeFrom=function(t,n){return e.current_input.pages_branch=n},e.setPrimaryDomain=function(e){return r.setPrimaryDomain({username:n.username,project_name:n.project_name},{domain:e},function(e){return m(),s.success().send("设置成功")})},e.formatDate=function(e){return moment(e).format("YYYY-M-D")},e.authenticateDomainOwnership=function(e){return r.authenticateDomainOwnership({username:n.username,project_name:n.project_name},{domain:e},function(e){return m(),s.success().send("设置成功，域名状态将在 10 分钟内生效")})},e.toggleDomainToPrimary=function(e){return r.setDomainToPrimary({username:n.username,project_name:n.project_name},{domain:e.name,to_primary:!e.to_primary},function(e){return m(),s.success().send("设置成功")})},e.requestSkipSplashReview=function(){return e.skipSplashReviewRequesting?void 0:(e.skipSplashReviewRequesting=!0,r.requestSkipSplashReview({username:n.username,project_name:n.project_name},{},function(t){return m(function(){return e.skipSplashReviewRequesting=!1}),s.success().send("提交审核成功")})["catch"](function(t,n){return e.skipSplashReviewRequesting=!1}))},e.cancelSkipSplashReview=function(){return"APPROVED"===e.pages_status.skip_splash_review.status||e.skipSplashReviewRequesting?void 0:(e.skipSplashReviewRequesting=!0,r.cancelSkipSplashReview({username:n.username,project_name:n.project_name},{},function(t){return m(function(){return e.skipSplashReviewRequesting=!1}),s.success().send("取消审核成功")})["catch"](function(t,n){return e.skipSplashReviewRequesting=!1}))},e.dismissSkipSplashReviewApprovedMessage=function(){return r.dismissSkipSplashReviewApprovedMessage({username:n.username,project_name:n.project_name},{},function(e){return m()})},e.showSkipSplashReviewType=function(t){return e.skipSplashReviewType=t},e.showSkipSplashReviewImageType=function(t){return e.skipSplashReviewImageType=t},e.checkedSkipSplashReviewCheckbox=function(){var t;return t=e.pages_status.skip_splash_review,t&&("PENDING"===t.status||"APPROVED"===t.status)}},a=n(1),r.$inject=["$scope","$rootScope","$routeParams","Depot","$location","Errors","PageTitle","Flash","$interval"],e.exports=a.module("git.pages",[]).controller("PagesController",r)},function(e,t,n){"use strict";var r,a,i;r=n(88),i=function(e,t){var n;return n=function(n,a,i){var o,s;return o=n.$eval(i.cgPlotViewLoadLength),o=o||50,s=new r({selector:"#network .svg",commits:[],w:25,h:30,paddingTop:10,paddingLeft:10,paddingBottom:10,paddingRight:10,project_path:n.PROJECT.project_path}),n.commits=[],n.hasPlotData=!0,n.loadMoreing=!1,n.loadPlot=1,n.loadPlotMore=function(){return n.loadPlot=n.loadPlot+1,n.loadMoreing=!0},n.$watch(i.cgPlotView,function(){var r;return r=e.plot({username:n.routeParams.username,project_name:n.PROJECT.name,length:n.commits.length+o,commitId:n.current_branch}),r["catch"](function(e,r){t.path("/u/"+n.routeParams.username+"/p/"+n.PROJECT.name+"/git")}),r.then(function(e){return n.loadMoreing=!1,0!==e.code?(n.$parent.loaded=!0,$(".ui.active.dimmer").remove(),void t.path("/u/"+n.routeParams.username+"/p/"+n.PROJECT.name+"/git")):(n.commits.length===e.data.commits.length&&e.data.commits&&(n.hasPlotData=!1),s.render(n.commits=e.data.commits),$(".ui.active.dimmer").remove(),$(".ui[data-content],.ui[data-html]").popup({className:{popup:"ignored ui popup plot"},position:"right center",offset:10,distanceAway:20,closable:!1}),n.$parent.loaded=!0)})})},{link:n}},a=n(1),i.$inject=["Depot","$location"],e.exports=a.module("git.plot.directive",[]).directive("cgPlotView",i)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){return e.inner_menu="plot",e.tag_menu="plot",t.region="plot",e.branches=[],e.routeParams=t,e.current_branch=t.branch||e.DEPOT.default_branch,n.set(i("i18n")("network","code_plot"),e.PROJECT.owner.global_key,e.PROJECT.name,"Coding.net"),r.listBranches({username:t.username,project_name:t.project_name},function(t){return e.branches=t.data}),e.changeCurrentBranch=function(t){return a.path(e.PROJECT.project_path+"/git/plot/"+t)}},a=n(1),r.$inject=["$scope","$routeParams","PageTitle","Depot","$location","$filter"],e.exports=a.module("git.plot",[]).controller("PlotController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,i,o){var s,c,u;return e.inner_menu="pulls",e.tag_menu="pulls",e.loaded=!1,a.isUndefined(n.region)?r.path(e.PROJECT.depot_path+"/pulls/open").replace():"open"!==n.region&&"closed"!==n.region&&"all"!==n.region&&r.path(e.PROJECT.depot_path+"/pulls/open"),e.status=n.region,e.data={},u=e.pager_id=(new Date).getTime(),s=o.instance(u,e),c=function(t){return i.pull_request_list({username:n.username,project_name:n.project_name,region:n.region||"open",page:t},function(t){return e.data=t.data,s.optionsReady(t.data),e.loaded=!0})["catch"](function(t,n){e.loaded=!0})},s.onChange(function(e){c(e)}),c(1),e.getMergeStatusClass=function(e){return"pull-right pr-status "+e.toLowerCase()},e.getMergeStatusHuman=function(e){return"ACCEPTED"===e?"已合并":"REFUSED"===e?"已拒绝":"CANMERGE"===e?"可合并":"CANNOTMERGE"===e?"不可合并":"CANCEL"===e?"已取消":void 0},e.getFilterByCenter=function(){var t,n;return"open"===e.status?t="未处理的":"closed"===e.status?n="已处理的":"all"===e.status?n="":void 0},e.getFilter=function(){var t,n;return"open"===e.status?t="未处理":"closed"===e.status?n="已处理":"all"===e.status?n="全部":void 0}},a=n(1),r.$inject=["$scope","$rootScope","$routeParams","$location","Depot","Pager"],e.exports=a.module("git.pull.index",[]).controller("PullRequestIndexController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){return e.inner_menu="pulls",e.tag_menu="pulls",e.pr_create={},e.branches=[],e.diffMode=t.diff||r("diff_mode")||"",""!==e.diffMode&&r("diff_mode",e.diffMode,{path:"/",expires:365}),i.set("创建 Pull Request",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),a.listBranches({username:t.username,project_name:t.project_name},function(t){return e.branches=t.data}),e.loading=!0,a.pull_request_create({username:t.username,project_name:t.project_name,src_branch:t.src_branch,des_user_name:t.des_user_name,des_project_name:t.des_project_name,des_branch:t.des_branch,diff:e.diffMode,w:t.w},function(n){return e.pr_create=n.data,e.diffStat=e.pr_create.pull_request.diffStat,e.diffHtml=e.pr_create.pull_request.htmlDiff,e.commits=e.pr_create.pull_request.commits,e.commits&&e.commits.length>0&&(e.commitId=e.commits[0].commitId,e.baseCommitId=e.commits[e.commits.length-1].commitId),e.pr_create.pull_request.des_path=n.data.target_project.owner_user_name+"/"+n.data.target_project.name,e.switchTab(t.tab||"commits")})["finally"](function(){return e.loading=!1}),e.changeDepot=function(e){var t;return e.srcBranch&&e.des_path&&e.desBranch?(t=e.des_path.split("/"),n.search({src_branch:e.srcBranch,des_branch:e.desBranch,des_user_name:t[0],des_project_name:t[1]})):void 0},e.submitPullRequest=function(e){return e.des_user_name=e.des_path.split("/")[0]||"",e.des_project_name=e.des_path.split("/")[1]||"",a.pull_request_submit({username:t.username,project_name:t.project_name},{src_branch:e.srcBranch,des_user_name:e.des_user_name,des_project_name:e.des_project_name,des_branch:e.desBranch,title:e.title||"",content:e.content||""},function(e){return n.url(e.data.path)})},e.contentUpdate=function(t){e.pr_create.pull_request.content=t},e.switchTab=function(t){return e.show_diff=t,"commits"===t&&(t=void 0),n.skipReload().search("tab",t)}},a=n(1),r.$inject=["$scope","$routeParams","location","ipCookie","Depot","PageTitle"],e.exports=a.module("git.pull.new",[]).controller("PullRequestNewController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t){return $("#pull-request-filter").dropdown(),t.change_status=function(n){return t.status=n,e.path(t.PROJECT.depot_path+"/pulls/"+n)}},a=n(1),r.$inject=["$location","$scope"],e.exports=a.module("git.pull.query-filter",[]).controller("PullRequestQueryFilterController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,i,o,s,c,u,d,l,m,f,p){var h,g,_,v;return e.inner_menu="pulls",e.tag_menu="pulls",e.comments_loaded=!1,e.loaded=!1,e.ignoreWhitespace="1"===n.w,e.enableWhitespace=!0,e.pull_request=[],e.comment={content:""},e.comments=[],e.is_project_member=!1,e.showMergeForm=!1,e.reloadComments=!1,e.diffMode=n.diff||m("diff_mode")||"",""!==e.diffMode&&m("diff_mode",e.diffMode,{path:"/",expires:365}),h=null,v=e.$watch("pull_request",function(t){a.isDefined(t)&&(h="pull_request_"+t.iid,e.comment.content=l[h],v&&v())}),_=function(t){var n,r;return n=[],r=!1,a.forEach(e.comments,function(e){return r?n.push(e):(a.forEach(e,function(e){return e.id===t?r=!0:void 0}),r?void 0:n.push(e))}),e.comments=n,e.commentCount-=1},g=function(){return e.comments_loaded=!1,o.pull_request_comments_list({username:n.username,project_name:n.project_name,iid:n.iid},function(t){var n;0===t.code?(e.comments=t.data,n=0,a.forEach(e.comments,function(e){return n+=e.length}),e.commentCount=n):c.handle(t),e.comments_loaded=!0,e.reloadComments=!1})},e.$watch(e.comment.content,function(e,t){return e!==t&&h&&""!==e?l[h]=e:void 0}),o.pull_request_show({username:n.username,project_name:n.project_name,iid:n.iid,diff:e.diffMode,w:e.ignoreWhitespace?"1":""},function(r){return e.pull_request=r.data.pull_request,e.diffStat=e.pull_request.diffStat,e.diffHtml=e.pull_request.htmlDiff,e.commits=e.pull_request.commits,e.commitsWithDate=p.commitsGroupByDate(e.commits),e.can_edit=r.data.can_edit,e.atConfig={target:e.pull_request,type:"pull_request_comment",extra:t.PROJECT},e.commits&&e.commits.length>0&&(e.baseCommitId=e.commits[e.commits.length-1].commitId,e.notesParams={commitId:e.commits[0].commitId,comments:r.data.line_notes,noteable_type:"PullRequestBean",noteable_id:e.pull_request.id,atConfig:e.atConfig}),e.pull_request.commit_message="Accept Pull Request #"+n.iid+" : ("+e.pull_request.src_owner_name+":"+e.pull_request.srcBranch+" -> "+e.PROJECT.owner_user_name+":"+e.pull_request.desBranch+")\n\nPull Request: "+e.pull_request.title+"\nCreated By: @"+e.pull_request.author.name+"\nAccepted By: @"+e.USER.name+"\nURL: "+i.$$absUrl,e.showContent(n.tab||"comments"),e.loaded=!0})["catch"](function(t,n){e.loaded=!0}),g(),e.USER&&s.members({id:e.PROJECT.id},function(t){return $(t.data.list).each(function(t,n){return n.user_id===e.USER.id?e.is_project_member=!0:void 0})}),e.toggleShowMergeForm=function(t){e.showMergeForm=!t},e.merge=function(t){return e.loaded=!1,o.pull_request_merge({username:n.username,project_name:n.project_name,iid:n.iid,message:t.commit_message,fastforward:t.fastforward},{},function(e){return r.reload()})["catch"](function(t,n){e.loaded=!0})},e.refuse=function(t){return confirm("确定要拒绝这个Pull Request么？")?(e.loaded=!1,o.pull_request_refuse({username:n.username,project_name:n.project_name,iid:n.iid},{},function(e){return r.reload()})["catch"](function(t,n){e.loaded=!0})):void 0},e.cancel=function(t){return confirm("确定要取消这个 Pull Request 么?")?(e.loaded=!1,o.pull_request_cancel({username:n.username,project_name:n.project_name,iid:n.iid},{},function(t){return f.success().send("取消成功"),i.path(e.PROJECT.project_path+"/git/pulls")})["catch"](function(t,n){e.loaded=!0})):void 0},e.getMergeStatusClass=function(e){return e?"pull-right pr-status "+e.toLowerCase():""},e.getMergeStatusHuman=function(e){return"ACCEPTED"===e?"已合并":"REFUSED"===e?"已拒绝":"CANMERGE"===e?"可自动合并":"CANNOTMERGE"===e?"不可自动合并":"CANCEL"===e?"已取消":void 0},e.addComment=function(r){return t.USER?r.length>0?o.add_line_note({username:n.username,project_name:n.project_name},{noteable_type:"PullRequestBean",noteable_id:e.pull_request.id,content:r},function(t){return e.comments.push([t.data]),e.commentCount+=1,delete l[h]}):void 0:void f.send("请登录后再评论")},e.delComment=function(e){return e&&confirm("确认删除该评论？")&&e&&confirm("请确认删除该评论")?o.del_line_note({username:n.username,project_name:n.project_name,id:e.id},function(t){return _(e.id)}):void 0},e.replyMerges=function(e){return e&&e.author?d.atPerson(e.author.name,"merges-comment-editor"):void 0},e.showContent=function(t){return e.show_diff=t,"comments"===t&&(t=void 0),i.skipReload().search("tab",t),!t&&e.reloadComments?g():void 0},e.onCommentChange=function(t){return e.comment.content=t},t.$on("line-notes.add",function(t,n,r){return 0===r?e.reloadComments=!0:e.commentCount+=1}),t.$on("line-notes.del",function(t,r,a){return 1!==a?e.commentCount-=1:(e.reloadComments=!0,n.tab&&"comments"!==n.tab?void 0:g())})},a=n(1),r.$inject=["$scope","$rootScope","$routeParams","$route","location","Depot","Project","Errors","Common","LightMdEditorService","$localStorage","ipCookie","Flash","GitService"],e.exports=a.module("git.pull.show",[]).controller("PullRequestShowController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){return e.inner_menu="release",e.tag_menu="release"},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","Flash","$location"],e.exports=a.module("git.release.edit",[]).controller("ReleaseEditController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){var s,c,u,d;return e.inner_menu="release",e.tag_menu="release",e.loaded=!1,e.releases=[],d=e.pager_id=(new Date).getTime(),s=a.instance(d,e),c=function(e,t){var n,r,a,i,o;if(i=e[t.target_type],i&&i.length>0)for(n=0,r=i.length;r>n;n++)if(a=i[n],a.code===t.code)return;return o=t.target_type,e[o]||(e[o]=[]),e[o].push(t)},u=function(a){return e.loaded=!1,n.releases({page:a,username:t.username,project_name:t.project_name},function(t){var n,a,i,o,u,d,l,m;if(t.data){for(l=t.data.list,n=0,i=l.length;i>n;n++)for(d=l[n],d.resourceReferences={},u=d.resource_references,a=0,o=u.length;o>a;a++)m=u[a],c(d.resourceReferences,m);e.releases=l,s.optionsReady(t.data)}r.set("Release",e.PROJECT.owner.global_key,e.PROJECT.name,"Coding.net"),e.loaded=!0})},u(1),s.onChange(function(e){u(e)}),e.deleteRelease=function(r){return n.deleteRelease({username:t.username,project_name:t.project_name,tag_name:r.name},function(t){return t&&0===t.code?(i.success().send(o("i18n")("deleted_successfully","code_release")),e.releases=$.map(e.releases,function(e){return e.name!==r.name?e:void 0})):void 0})},e.isSameDay=function(e,t){return 0===t?!1:new Date(e[t].created_at).getDate()===new Date(e[t-1].created_at).getDate()},e.isSameYear=function(e,t){return 0===t?!1:new Date(e[t].created_at).getYear()===new Date(e[t-1].created_at).getYear()},e.isToday=function(e){return moment(new Date(e)).format("YYYY-MM-DD")===moment(new Date).format("YYYY-MM-DD")}},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","Flash","$filter"],e.exports=a.module("git.release.index",[]).controller("ReleaseIndexController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){var s,c,u,d,l,m,f,p,h,g,_;return e.inner_menu="release",e.tag_menu="release",e.refs=[],e.compareTagNames=[],e.uploading=!1,p=function(){return{tagName:"",commitSha:"",targetCommitish:"",title:"",body:"",compareTagName:"",resourceReferences:{},attachments:[]}},e.release=p(),d=function(e){var t;if("number"==typeof e&&0!==e)return!1;if("string"==typeof e&&e.length>0)return!1;if("object"==typeof e)for(t in e)if(!d(e[t]))return!1;return!0},u=function(){var t,n;for(t in e.release)if("targetCommitish"!==t&&"commitSha"!==t&&(n=e.release[t],!d(n)))return!0;return!1},c=function(){var t,n;return n=o("i18n")("exit_without_save","code_release"),t=function(){return u()?n:void 0},$(window).on("beforeunload",t),e.$on("$locationChangeStart",function(e){u()&&!window.confirm(n)&&e.preventDefault()}),e.$on("$routeChangeStart",function(e){$(window).off("beforeunload",t)})},c(),e.updateCommitSha=function(r){return n.resolveRef({username:t.username,project_name:t.project_name,ref:r},function(t){return t&&0===t.code&&t.data?e.release.commitSha=t.data.commitId:void 0})["catch"](function(t,n){return e.release.commitSha=""})},f=function(){var r,a,o;return o={username:t.username,project_name:t.project_name,withoutReleaseTags:!0},r=n.listBranches(o),a=n.listTags(o),i.all([r,a]).then(function(t){var n,r,a,i,o,s,c,u;for(c=[],n=0,a=t.length;a>n;n++)for(u=t[n],s=u.data,r=0,i=s.length;i>r;r++)o=s[r],c.push(o.name);return e.refs=c,c&&c.length>0?(e.release.targetCommitish=c[0],e.updateCommitSha(c[0])):void 0})},f(),m=function(){return n.listReleaseTagNames({username:t.username,project_name:t.project_name},function(t){return t&&0===t.code&&t.data?e.compareTagNames=t.data:void 0})},m(),g=function(e){var t,n,r,a,i,o;n=[];for(o in e)for(i=e[o],t=0,r=i.length;r>t;t++)a=i[t],n.push(a.code);return n},h=function(e){var t,n,r,a;for(a={},n=0,r=e.length;r>n;n++)t=e[n],!t.failed&&t.id>0&&(a[t.id]=t.name);return a},l=function(e){var t,n,r;for(n=0,r=e.length;r>n;n++)if(t=e[n],t.uploading)return!0;return!1},e.createRelease=function(i){return!i.tagName||i.tagName.length<=0?r.fail().send(o("i18n")("tag_name_cannot_be_empty","code_release")):l(i.attachments)?r.fail().send(o("i18n")("submmit_after_finishing_upload","code_release")):n.createRelease({username:t.username,project_name:t.project_name},{tag_name:"release/"+i.tagName,commit_sha:i.commitSha,target_commitish:i.targetCommitish,title:i.title,body:i.body,compare_tag_name:i.compareTagName,resource_references:g(i.resourceReferences),attachments:h(i.attachments)},function(t){return t&&0===t.code?(e.release=p(),r.success().send(o("i18n")("created_successfully","code_release")),a.path(e.PROJECT.project_path+"/git/releases")):void 0})},_=!0,e.updateTitle=function(){return _?e.release.title=e.release.tagName:void 0},e.updateTitleFollowsTagName=function(){return _=e.release.title.length<=0},e.onContentChange=function(t){return e.release.body=t},s=function(e,t){var n,r,a,i,o;if(i=e[t.target_type],i&&i.length>0)for(n=0,r=i.length;r>n;n++)if(a=i[n],a.code===t.code)return;return o=t.target_type,e[o]||(e[o]=[]),e[o].push(t)},e.$watch("[release.compareTagName,release.commitSha]",function(r){return null!=r&&r[0]&&r[1]?n.findRelatedResourcesForRelease({username:t.username,project_name:t.project_name},{baseRef:r[0],targetRef:r[1]},function(t){var n,r,a,i,c;if(t&&0===t.code){for(d(e.release.resourceReferences)||confirm(o("i18n")("clear_selected_resources","code_release"))&&(e.release.resourceReferences={}),a=t.data,c=[],n=0,r=a.length;r>n;n++)i=a[n],c.push(s(e.release.resourceReferences,i));return c}}):void 0},!0)},a=n(1),r.$inject=["$scope","$routeParams","Depot","Flash","$location","$q","$filter"],e.exports=a.module("git.release.new",[]).controller("ReleaseNewController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o){return e.inner_menu="release",e.tag_menu="release"},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","Flash","$location"],e.exports=a.module("git.release.show",[]).controller("ReleaseShowController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c;return e.inner_menu="release",e.tag_menu="release",e.loaded=!1,e.tags=[],c=e.pager_id=(new Date).getTime(),o=a.instance(c,e),s=function(a){return n.tags({page:a,username:t.username,project_name:t.project_name},function(t){t.data&&(e.tags=t.data.list,o.optionsReady(t.data)),r.set("标签",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0})},o.onChange(function(e){s(e)}),s(1),e.delete_tag=function(r){return confirm("确定要删除该标签("+r.name+")么？")?n.delete_tag({username:t.username,project_name:t.project_name},{tag_name:r.name},function(t){return i.success().send("删除成功"),e.tags=$.map(e.tags,function(e){return e.name!==r.name?e:void 0})}):void 0},e.isSameDay=function(e,t){return 0===t?!1:new Date(e[t].created_at).getDate()===new Date(e[t-1].created_at).getDate()},e.isSameYear=function(e,t){return 0===t?!1:new Date(e[t].created_at).getYear()===new Date(e[t-1].created_at).getYear()},e.isToday=function(e){
return moment(new Date(e)).format("YYYY-MM-DD")===moment(new Date).format("YYYY-MM-DD")},e.showMessage=function(e){return e.showMessage=!e.showMessage}},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","Flash"],e.exports=a.module("git.release.tag.index",[]).controller("TagIndexController2",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a){return e.inner_menu="release",e.tag_menu="release",e.loaded=!1,e.submitting=!1,e.new_tag={name:"",tag_point:n.search().startWith||"",message:""},e.create_tag=function(i){return e.submitting=!0,r.create_tag({username:t.username,project_name:t.project_name},{message:i.message,tag_name:i.name,tag_point:i.tag_point},function(t){return e.submitting=!0,a.success().send("创建成功"),n.path(e.PROJECT.project_path+"/git/tags2")})["catch"](function(t,n){e.submitting=!1})}},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","Flash"],e.exports=a.module("git.release.tag.new",[]).controller("TagNewController2",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c;return e.tag_menu="basic",e.loaded=!1,e.stargazers=[],r.set("收藏者",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),c=e.pager_id="stargazers:"+(new Date).getTime(),o=a.instance(c,e),s=o.onChange().then(null,null,function(t){return e.loadData(t)}),e.loadData=function(n){return e.loaded=!1,t.stargazers_paging({username:e.PROJECT.owner_user_name,project_name:e.PROJECT.name,page:n,pageSize:15},function(t){return o.optionsReady(t.data),e.stargazers=t.data.list,e.loaded=!0})},e.follow=function(e){return e?n.follow({users:e.global_key},{},function(t){return e.followed=!0}):void 0},e.unfollow=function(e){return e?n.unfollow({users:e.global_key},{},function(t){return e.followed=!1}):void 0},e.loadData(o.currentPage())},a=n(1),r.$inject=["$scope","Project","User","PageTitle","Pager","$rootScope"],e.exports=a.module("git.public.stargazers",[]).controller("StargazersController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c;return e.inner_menu="tag",e.tag_menu="tag",e.loaded=!1,e.tags=[],c=e.pager_id=(new Date).getTime(),o=a.instance(c,e),s=function(a){return n.tags({page:a,username:t.username,project_name:t.project_name},function(t){t.data&&(e.tags=t.data.list,o.optionsReady(t.data)),r.set("标签",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.loaded=!0})},o.onChange(function(e){s(e)}),s(1),e.delete_tag=function(r){return confirm("确定要删除该标签("+r.name+")么？")?n.delete_tag({username:t.username,project_name:t.project_name},{tag_name:r.name},function(t){return i.success().send("删除成功"),e.tags=$.map(e.tags,function(e){return e.name!==r.name?e:void 0})}):void 0},e.isSameDay=function(e,t){return 0===t?!1:new Date(e[t].created_at).getDate()===new Date(e[t-1].created_at).getDate()},e.isSameYear=function(e,t){return 0===t?!1:new Date(e[t].created_at).getYear()===new Date(e[t-1].created_at).getYear()},e.isToday=function(e){return moment(new Date(e)).format("YYYY-MM-DD")===moment(new Date).format("YYYY-MM-DD")},e.showMessage=function(e){return e.showMessage=!e.showMessage}},a=n(1),r.$inject=["$scope","$routeParams","Depot","PageTitle","Pager","Flash"],e.exports=a.module("git.tag.index",[]).controller("TagIndexController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a){return e.inner_menu="tag",e.tag_menu="tag",e.loaded=!1,e.submitting=!1,e.new_tag={name:"",tag_point:n.search().startWith||"",message:""},e.create_tag=function(i){return e.submitting=!0,r.create_tag({username:t.username,project_name:t.project_name},{message:i.message,tag_name:i.name,tag_point:i.tag_point},function(t){return e.submitting=!0,a.success().send("创建成功"),n.path(e.PROJECT.project_path+"/git/tags")})["catch"](function(t,n){e.submitting=!1})}},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","Flash"],e.exports=a.module("git.tag.new",[]).controller("TagNewController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i,o,s,c,u,d,l,m){var f,p,h,g,_,v;return e.inner_menu="basic",e.tag_menu="basic",e.type="tree",e.can_edit=!1,e.empty=!1,e.isHead=!1,e.loaded=!1,e.too_many_files=!1,e.readme=void 0,e.parentLink=[],e.tree=[],e.infos={},e.path=[],e.ref=e.DEPOT.default_branch||"",e.CodingUrl=n.path(),e.md5=o,e.fileTypeIcon={tree:"folder icon",file:"file outline icon",image:"file outline icon",executable:"terminal outline icon",git_link:"folder icon",sym_link:"url icon"},e.fileIcon=function(t){return l.smartSwitch(e.fileTypeIcon,t,t)},e.DEPOT===!1?(e.empty=!0,void(e.loaded=!0)):(e.DEPOT===!1||""===e.ref?(f=r.depot({username:t.username,project_name:t.project_name}),f.then(function(i){var o,c,u;return e.DEPOT=i.data.depot,s.DEPOT=e.DEPOT,e.ref=e.DEPOT.default_branch||"",e.DEPOT===!1?(e.empty=!0,void(e.loaded=!0)):""===e.ref?(e.loaded=!0,void(e.empty=!0)):(o=/^\/(u|t)\/[^\/]+\/p\/[^\/]+\/git[\/]?$/,u=n.path(),o.test(u)&&(u=u+"/tree/"+e.DEPOT.default_branch),c=u.substring(u.search("/git/tree/")+10,u.length),e.tree_url=u.replace(/\/(u|t)\/[^\/]+\/p\/[^\/]+[\/]/,"/api/user/"+t.username+"/project/"+t.project_name+"/"),r.tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(c)},function(t){return t.data.files?(e.loaded=!0,e.tree=t.data,e.ref=encodeURIComponent(t.data.ref).replace(/%2F/g,"/"),e.path=t.data.path?encodeURIComponent(t.data.path).replace(/%2F/g,"/"):"",e.readme=t.data.readme,e.isHead=t.data.isHead,e.can_edit=t.data.can_edit,e.too_many_files=t.data.too_many_files,e.path&&(e.parentLink=e.PROJECT.project_path+"/git/tree/"+e.ref+"/"+e.path.substring(0,e.path.lastIndexOf("/"))),e.path&&e.path.length>0?a.set(t.data.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"):a.set(e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.shortMessage=e.tree.lastCommit.shortMessage,e.fullMessage=e.tree.lastCommit.fullMessage,e.allMessage=e.tree.lastCommit.allMessage,e.showAllMessage=!1):void 0}))})):(h=/^\/(u|t)\/[^\/]+\/p\/[^\/]+\/git[\/]?$/,v=n.path(),h.test(v)&&(v=v+"/tree/"+e.DEPOT.default_branch),g=v.substring(v.search("/git/tree/")+10,v.length),e.tree_url=v.replace(/\/(u|t)\/[^\/]+\/p\/[^\/]+[\/]/,"/api/user/"+t.username+"/project/"+t.project_name+"/"),r.tree({username:t.username,project_name:t.project_name,region:encodeURIComponent(g)},function(t){return t.data.files?(e.loaded=!0,e.tree=t.data,e.ref=encodeURIComponent(t.data.ref).replace(/%2F/g,"/"),e.path=t.data.path?encodeURIComponent(t.data.path).replace(/%2F/g,"/"):"",e.readme=t.data.readme,e.isHead=t.data.isHead,e.can_edit=t.data.can_edit,e.too_many_files=t.data.too_many_files,e.path&&(e.parentLink=e.PROJECT.project_path+"/git/tree/"+e.ref+"/"+e.path.substring(0,e.path.lastIndexOf("/"))),e.path&&e.path.length>0?a.set(t.data.path,e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"):a.set(e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),e.shortMessage=e.tree.lastCommit.shortMessage,e.fullMessage=e.tree.lastCommit.fullMessage,e.allMessage=e.tree.lastCommit.allMessage,e.showAllMessage=!1):(n.path(e.PROJECT.project_path+"/git"),i.fail().send(m("i18n")("file_path_not_exist","code_tree")))})),e.toggleShowAllMessage=function(t){e.showAllMessage=!t},e.copyCommit=function(){e.showCopyIcon=!0,setTimeout(function(){e.showCopyIcon=!1,e.$digest()},1e3)},p=function(){var t,r,a,i;return u.gitUploadDropZoneTimeout=null,a=function(){var e;return e=c.find("#git_upload_dragenter"),e.dimmer("is animating")|e.dimmer("is active")},t=function(e){var t,n,r,i,o;for(e.preventDefault(),t=c,r=c.find("#git_upload_dragenter"),o=u.gitUploadDropZoneTimeout,o||a()?d.cancel(o):r.dimmer("show"),n=!1,i=e.target;;){if(i===t[0]){n=!0;break}if(i=i.parentNode,null!==i)break}return n?a()||r.dimmer("show"):r.dimmer("hide"),u.gitUploadDropZoneTimeout=d(function(){return u.gitUploadDropZoneTimeout=null,r.dimmer("hide")},100)},c.bind("dragover",t),i=function(e,t){var n;return t=t||"",e.isFile?e.file(function(e){return s.gitUploadFilesDroppedOnTreePage[t+e.name]=e}):e.isDirectory?(n=e.createReader(),n.readEntries(function(n){var r,a,o,s;for(s=[],a=0,o=n.length;o>a;a++)r=n[a],s.push(i(r,t+e.name+"/"));return s})):void 0},r=function(t){var r,a,o,c,u,d,l,m,f,p,h;if(t.preventDefault(),s.gitUploadFilesDroppedOnTreePage={},d=t.originalEvent.dataTransfer.items,d&&d.length)for(c=0,m=d.length;m>c;c++)u=d[c],r=u.webkitGetAsEntry(),r&&i(r);else for(h=t.originalEvent.dataTransfer.files,l=0,f=h.length;f>l;l++)o=h[l],s.gitUploadFilesDroppedOnTreePage[o.name]=o;return a=n.path(),p=a.search("/tree/")>-1?a.replace("/tree/","/upload/"):a+"/upload/"+e.ref,n.path(p),!1},c.bind("drop",r),e.$on("$destroy",function(){return c.unbind("dragover",t),c.unbind("drop",r)})},_=e.$watch("loaded",function(t){return t?(e.can_edit&&p(),_&&_()):void 0},!0))},a=n(1),r.$inject=["$scope","$routeParams","$location","Depot","PageTitle","Flash","md5","$rootScope","$document","$window","$timeout","Common","$filter"],e.exports=a.module("git.tree",[]).controller("TreeController",r)},function(e,t,n){"use strict";var r,a;r=function(e,t,n,r,a,i){var o,s,c;return e.tag_menu="basic",e.loaded=!1,e.watchers=[],r.set("关注者",e.PROJECT.owner_user_name,e.PROJECT.name,"Coding.net"),c=e.pager_id="watchers:"+(new Date).getTime(),o=a.instance(c,e),s=o.onChange().then(null,null,function(t){return e.loadData(t)}),e.loadData=function(n){return e.loaded=!1,t.watchers_paging({username:e.PROJECT.owner_user_name,project_name:e.PROJECT.name,page:n,pageSize:15},function(t){return o.optionsReady(t.data),e.watchers=t.data.list,e.loaded=!0})},e.follow=function(e){return!e.followed_loading&&(e.followed_loading=!0,e)?n.follow({users:e.global_key},{},function(t){return e.followed=!0,e.followed_loading=!0})["catch"](function(t,n){e.followed_loading=!0}):void 0},e.unfollow=function(e){return!e.followed_loading&&(e.followed_loading=!0,e)?n.unfollow({users:e.global_key},{},function(t){return e.followed=!1,e.followed_loading=!0})["catch"](function(t,n){e.followed_loading=!0}):void 0},e.loadData(o.currentPage())},a=n(1),r.$inject=["$scope","Project","User","PageTitle","Pager","$rootScope"],e.exports=a.module("git.public.watchers",[]).controller("WatchersController",r)},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e,t,n,r,i,o,s,c,u){e.loading=!1,e.message="",e.$watchCollection("merge_request",function(t){t&&t.commits&&(e.message=d())});var d=function(){var t="",n=e.merge_request.commits;return a.forEach(n,function(e,r){t+=e.fullMessage,r<n.length-1&&(t+="\n")}),t=r.htmlToPlaintext(t),t+=["\n\n","Squash from ",n[0].commitId.substring(0,7)," to ",n[n.length-1].commitId.substring(0,7)," by ",s.USER.global_key].join("")};e.squash=function(r){if(!e.squashing){if(""===r)return void c.fail().send(u("i18n")("please_input_commit_message","code_merge"));e.squashing=!0;var a=t.merge_request_squash({username:n.username,project_name:n.project_name,iid:n.iid},{message:r});a.then(function(){o.search("tab","commits"),i.reload(),c.success().send(u("i18n")("option_successfully","code_merge"))}),a["catch"](function(e){c.fail().send(u("i18n")("operation_failed","common"))}),a["finally"](function(){e.squashing=!1})}}}var a=n(1);e.exports=a.module("git.merge.squash",[]).controller("MergeRequestSquashModalCtrl",r),r.$inject=["$scope","Depot","$routeParams","Common","$route","$location","$rootScope","Flash","$filter"]},function(e,t){"use strict";var n=function(e){this.w=e.w||30,this.h=e.h||30,this.commits=e.commits||[],this.paddingTop=e.paddingTop||0,this.paddingLeft=e.paddingLeft||0,this.paddingRight=e.paddingRight||0,this.paddingBottom=e.paddingBottom||0,this.selector=e.selector||"",this.svg=e.svg||d3.select(e.selector).append("svg"),this.r=e.r||5,this.mr=e.mr||10,this.lw=e.lw||2,this.dw=e.dw||25,this.project_path=e.project_path||"",this.colors=e.colors||["#35a266","#EBB741","#CC6ADD","#F1D3D7"],this.pcolors=[],this.restoreColors(),this.maxLane=this.getMaxLane(this.commits),this.lineFunction=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),this.preMonth=null,this.preDay=null,this.monthFormat=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.dotColor=this.getColor()};n.prototype={init:function(e){this.svg.remove(),this.svg=d3.select(this.selector).append("svg"),this.commits=e,this.resize(),this.maxLane=this.getMaxLane(this.commits),this.drawMonth(0,0,this.dw,this.paddingTop),this.drawDay(0+this.dw,0,this.dw,this.paddingTop);for(var t=0;t<this.commits.length;t++){var n=this.commits[t];this.drawCommit(n,t*this.h+this.paddingTop);var r=new Date(n.date);this.preMonth!=r.getMonth()?(this.preMonth=r.getMonth(),this.drawMonth(0,t*this.h+this.paddingTop,this.dw,this.h,this.preMonth)):this.drawMonth(0,t*this.h+this.paddingTop,this.dw,this.h),this.preDay!=r.getDate()?(this.preDay=r.getDate(),this.drawDay(0+this.dw,t*this.h+this.paddingTop,this.dw,this.h,this.preDay)):this.drawDay(0+this.dw,t*this.h+this.paddingTop,this.dw,this.h)}var a=this.commits.length;this.drawMonth(0,a*this.h+this.paddingBottom,this.dw,this.paddingBottom),this.drawDay(0+this.dw,a*this.h+this.paddingBottom,this.dw,this.paddingBottom)},render:function(e){this.init(e)},resize:function(){this.svg.attr({width:"100%",height:this.commits.length*this.h+this.paddingTop+this.paddingBottom,opacity:1})},drawCommit:function(e,t){var n=e.lane,r=this.laneC(n),a=e.passingLanes,i=e.forkingOffLanes,o=e.mergingLanes,s=0,c=r,u=t+this.h/2,d=this.paddingRight+2*this.dw+(this.maxLane+1)*this.w+this.paddingLeft;this.drawDottedLine(e,c,u,d,u);var l=new Date(e.date);this.preDay!=l.getDate()&&(this.dotColor=this.getColor());var m,f;if(a)for(m=0;m<a.length;m++)f=this.laneC(a[m]),this.drawLine(e,f,t,f,t+this.h,!1),s=Math.max(s,f);if(o)for(m=0;m<o.length;m++)f=this.laneC(o[m]),Math.abs(r-f)>this.w?(this.drawLine(e,r,t+this.h/2,f-this.w/2,t+this.h/2),this.drawLine(e,f-this.w/2,t+this.h/2,f,t+this.h)):this.drawLine(e,r,t+this.h/2,f,t+this.h);if(i)for(m=0;m<i.length;m++)f=this.laneC(i[m]),Math.abs(r-f)>this.w?(this.drawLine(e,r,t+this.h/2,f-this.w/2,t+this.h/2),this.drawLine(e,f-this.w/2,t+this.h/2,f,t)):this.drawLine(e,r,t+this.h/2,f,t);var p=e.children;p&&p.length>0&&this.drawLine(e,r,t,r,u),this.drawGravatar(e,d,u-this.h/4),this.drawText(e,d+this.paddingLeft+this.w,u+this.h/8),this.drawLine(e,c,u,c,u+this.h/2,!1),this.drawDot(e,c,u,e.tag)},getCommitById:function(e){for(var t=0;t<this.commits.length;t++){var n=this.commits[t];if(n.id==e)return n}},restoreColors:function(){for(var e=0;e<this.colors.length;e++)this.pcolors[e]=this.colors[e]},getColor:function(){var e=this.pcolors.pop();return 0===this.pcolors.length&&this.restoreColors(),e},drawDot:function(e,t,n,r){var a=this,i=a.commitHTML(e),o=a.svg.append("g").attr({transform:"translate(0,"+n+")",fill:"#FFF","class":"ui circular heart icon link","data-html":i});r&&o.insert("circle").attr({r:this.r+2,"stroke-width":1,stroke:"#888",fill:"rgba(0,0,0,0)"}),o.append("circle").attr({r:this.r,"stroke-witdh":this.lw,fill:this.dotColor}).on("mouseover",function(){d3.select(this).attr("transform","scale(2)")}).on("mouseout",function(){d3.select(this).attr("transform","scale(1)")}).on("mousedown",function(){window.location.href=a.project_path+"/git/commit/"+e.id}),o.transition().duration(3e3).attr({transform:"translate("+t+","+n+")"})},drawDottedLine:function(e,t,n,r,a){var i=[{x:0,y:n},{x:0,y:a}],o=[{x:t,y:n},{x:r,y:a}],s=(d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),this.svg.append("path").attr({d:this.lineFunction(i),stroke:"#eee","stroke-width":this.lw,"stroke-dasharray":"1,3",fill:"#666"}));s.transition().duration(2e3).attr({d:this.lineFunction(o)})},drawLine:function(e,t,n,r,a){n==a?(t-=this.lw/2,r-=this.lw/2):t==r&&(n-=this.lw/2,a-=this.lw/2);var i=[{x:t,y:n},{x:t,y:n}],o=[{x:t,y:n},{x:r,y:a}],s=(d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),this.svg.append("path").attr({d:this.lineFunction(i),stroke:"#999","stroke-width":this.lw,fill:"#999"}));s.transition().duration(1e3).attr({d:this.lineFunction(o)})},drawText:function(e,t,n){var r=this,a=this.svg.append("g").attr("transform","translate("+t+","+n+")");a.insert("text").attr({id:"xLabel","text-anchor":"left","font-size":"12px",fill:"#555","class":"text"}).text(e.shortMessage).on("mousedown",function(){window.location.href=r.project_path+"/git/commit/"+e.id})},drawGravatar:function(e,t,n){var r=this.h/2;this.svg.append("rect").attr({transform:"translate("+(t-1.5)+","+(n-1)+")",width:r+3,height:r+3,fill:"rgba(0,0,0,0)","stroke-witdh":1,stroke:"#999",opacity:1}),this.svg.insert("image").attr("transform","translate("+t+","+n+")").attr("style","z-index:-1").attr({id:"xLabel","xlink:href":e.author.gravatar,src:e.author.gravatar,"text-anchor":"left",width:r,height:r,opacity:1}).text(e.shortMessage)},drawDay:function(e,t,n,r,a){this.drawRectAndText("#666",e,t,n,r,a,-1,18)},drawMonth:function(e,t,n,r,a){this.drawRectAndText("#333",e,t,n,r,this.monthFormat[a],-1,18)},drawRectAndText:function(e,t,n,r,a,i,o,s){this.svg.append("rect").attr({transform:"translate("+t+","+n+")",width:r,height:a,fill:e,opacity:1});i&&(i=this.svg.append("text").attr({transform:"translate("+(t+r/2)+","+n+")",id:"xLabel","text-anchor":"middle","font-size":"12px",fill:"#FFF",color:"#FFF",x:o,y:s,opacity:1}).text(i))},laneX:function(e){return this.paddingLeft+2*this.dw+this.w*e},laneC:function(e){return this.laneX(e)+this.w/2},getMaxLane:function(e){for(var t=0,n=0;n<e.length;n++){var r=e[n];t=Math.max(r.lane,t)}return t},commitHTML:function(e){var t=[];return t.push("<div class='commit_info_popup'>"),t.push("<div class='author'><img src='"+e.author.gravatar+"' width='50' height='50'><p class='author_name'>"+e.author.name+"</p> <p class='author_email'><a href='emailto:"+e.author.email+"'>"+e.author.email+"</a></p><div class='clean'></div></div>"),t.push("<p><label class='commit_id'>"+e.id+"</label></p>"),t.push("<p><label class='commit_date'>"+new Date(e.date).toLocaleString()+"</label></p>"),e.tag&&t.push("<p><label class='commit_tag' style='color:"+this.dotColor+"'>"+e.tag+"</label></p>"),t.push("<p><label class='commit_message'>"+e.message+"</label></p>"),t.push("<div>"),t.join("")}},e.exports=n}]);